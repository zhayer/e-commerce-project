import*as t from"@surecart/api-fetch";import*as e from"@wordpress/interactivity";var n={d:function(t,e){for(var r in e)n.o(e,r)&&!n.o(t,r)&&Object.defineProperty(t,r,{enumerable:!0,get:e[r]})},o:function(t,e){return Object.prototype.hasOwnProperty.call(t,e)}},r={};n.d(r,{Pp:function(){return I},F4:function(){return w},pc:function(){return l},P$:function(){return P},fT:function(){return p},fu:function(){return m},NN:function(){return b},u0:function(){return y},vO:function(){return $},Rr:function(){return f},ik:function(){return C},Mt:function(){return v},c1:function(){return x},zN:function(){return k},xe:function(){return g},U:function(){return h},ws:function(){return _}});var i,o,u=(i={default:function(){return t.default}},o={},n.d(o,i),o),a=function(t){var e={};return n.d(e,t),e}({getContext:function(){return e.getContext},store:function(){return e.store}});const{addQueryArgs:d,getQueryArg:c}=wp.url,l="surecart/v1/checkouts/",{state:s}=(0,a.store)("surecart/checkout"),p=["line_items","line_item.price","line_item.fees","line_item.variant","variant.image","price.product","product.featured_product_media","product.product_collections","product.product_medias","product_media.media","customer","customer.shipping_address","payment_intent","discount","discount.promotion","recommended_bumps","bump.price","current_upsell","product.variants","discount.coupon","shipping_address","tax_identifier","manual_payment_method","shipping_choices","shipping_choice.shipping_method"],f=function(t){let e=t?`${l}${t}`:l;return e=`${e}${arguments.length>1&&void 0!==arguments[1]?arguments[1]:""}`,d(e,{expand:p})};function m(t){let{id:e,query:n={}}=t;return function*(){return yield(0,u.default)({path:d(f(e),_(n))})}()}const h=t=>({live_mode:"test"!==(0,a.getContext)().mode,group_key:s.groupId,abandoned_checkout_enabled:s.abandonedCheckoutEnabled,metadata:{...t?.metadata||{},...window?.scData?.page_id&&{page_id:window?.scData?.page_id},...s?.product?.id&&{buy_page_product_id:s?.product?.id},page_url:window.location.href},...s?.checkout?.email&&{email:s?.checkout?.email},...t}),_=function(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const e=(0,a.getContext)();return{...!!e?.formId&&{form_id:e?.formId},...!!s?.product?.id&&{product_id:s?.product?.id},...t}},y=()=>c(window.location.href,"checkout_id")||(s?.checkout?.id?s?.checkout?.id:null);function g(t){let{id:e,data:n}=t;return function*(){const t=yield(0,u.default)({path:d(`surecart/v1/line_items/${e}`,{expand:[...(p||[]).map((t=>t.includes(".")?t:`checkout.${t}`)),"checkout"]}),method:"PATCH",data:n});return t?.checkout}()}function k(t){let{id:e,data:n}=t;return function*(){try{return s.loading=!0,yield*g({id:e,data:n})}catch(t){if(console.error(t),s.error=t,"line_item.invalid"===t.code)return null}finally{s.loading=!1}}()}function v(t){let{checkoutId:e,itemId:n}=t;return function*(){const{deleted:t}=yield(0,u.default)({path:`surecart/v1/line_items/${n}`,method:"DELETE"});return{deleted:t}}()}function*C(t){try{s.loading=!0;const{deleted:e}=yield*v({checkoutId:s?.checkout?.id,itemId:t});if(!e)throw{code:"error",message:__("Failed to delete","surecart")};return yield*m({id:s?.checkout?.id})}catch(t){if(console.error(t),s.error=t,console.log(t.code),"line_item.invalid"===t.code)return null}finally{s.loading=!1}}function w(t){let{checkout:e,data:n,live_mode:r=!1}=t;return function*(){const t=(e?.line_items?.data||[]).find((t=>t?.variant?.id?t.variant.id===n.variant&&t.price.id===n.price:t.price.id===n.price));if(!e?.id)return yield(0,u.default)({method:"POST",path:d(f(null)),data:{line_items:[n],live_mode:r}});if(t)return yield*g({id:t?.id,data:{...n,quantity:t?.quantity+n?.quantity}});const i=yield(0,u.default)({path:d(`surecart/v1/line_items/${t?.id?t?.id:""}`,{consolidate:!0,expand:[...(p||[]).map((t=>t.includes(".")?t:`checkout.${t}`)),"checkout"]}),method:"POST",data:{...n,checkout:e.id}});return i?.checkout}()}function*I(t){const e=(0,a.getContext)();try{return s.loading=!0,yield*w({checkout:s.checkout,data:t,live_mode:"test"!==e.mode})}catch(t){console.error(t),s.error=t}finally{s.loading=!1}}function P(t){let{id:e=null,data:n={},query:r={}}=t;return function*(){return e=e??y(),yield(0,u.default)({method:e?"PATCH":"POST",path:d(f(e),_(r)),data:h(n)})}()}function x(t){let{data:e={},query:n={}}=t;return function*(){const t=e?.id??y();return yield(0,u.default)({method:"PATCH",path:d(f(t),_(n)),data:h(e)})}()}function b(t){let{id:e,data:n={},query:r={},processor:i}=t;return function*(){return yield(0,u.default)({method:"POST",path:d(f(e,"/finalize"),_({...i?.manual?{manual_payment:!0,manual_payment_method_id:i?.id}:{processor_type:i?.id},...r})),data:h(n)})}()}function*$(t){try{return s.loading=!0,yield*x({data:{discount:{...t?{promotion_code:t}:{}}}})}catch(t){console.error(t),s.error=t}finally{s.loading=!1}}var O=r.Pp,T=r.F4,q=r.pc,L=r.P$,A=r.fT,D=r.fu,N=r.NN,S=r.u0,z=r.vO,E=r.Rr,U=r.ik,F=r.Mt,H=r.c1,Q=r.zN,j=r.xe,M=r.U,R=r.ws;export{O as addCheckoutLineItem,T as addLineItem,q as baseUrl,L as createOrUpdateCheckout,A as expand,D as fetchCheckout,N as finalizeCheckout,S as getSessionId,z as handleCouponApply,E as parsePath,U as removeCheckoutLineItem,F as removeLineItem,H as updateCheckout,Q as updateCheckoutLineItem,j as updateLineItem,M as withDefaultData,R as withDefaultQuery};