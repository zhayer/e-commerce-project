import{proxyCustomElement,HTMLElement,createEvent,h,Host}from"@stencil/core/internal/client";import{a as apiFetch}from"./fetch.js";import{d as defineCustomElement$9}from"./sc-alert2.js";import{d as defineCustomElement$8}from"./sc-button2.js";import{d as defineCustomElement$7}from"./sc-dialog2.js";import{d as defineCustomElement$6}from"./sc-form2.js";import{d as defineCustomElement$5}from"./sc-form-control2.js";import{d as defineCustomElement$4}from"./sc-icon2.js";import{d as defineCustomElement$3}from"./sc-input2.js";import{d as defineCustomElement$2}from"./sc-spinner2.js";import{d as defineCustomElement$1}from"./sc-visually-hidden2.js";const scLoginProviderCss=":host{display:block}",ScLoginProviderStyle0=scLoginProviderCss,ScLoginProvider=proxyCustomElement(class extends HTMLElement{constructor(){super(),this.__registerHost(),this.__attachShadow(),this.scSetLoggedIn=createEvent(this,"scSetLoggedIn",7),this.scSetCustomer=createEvent(this,"scSetCustomer",7),this.loggedIn=void 0,this.order=void 0,this.notice=void 0,this.open=void 0,this.loading=void 0,this.error=void 0}handleLoginPrompt(){this.open=!0}handleLoginDialogChange(e){e&&setTimeout((()=>{this.loginForm.querySelector("sc-input").triggerFocus()}),100)}handleLoggedInChange(e,t){!1===t&&e&&(this.notice=!0)}handleOrderChange(e,t){(null==e?void 0:e.updated_at)!==(null==t?void 0:t.updated_at)&&(this.notice=!1)}async handleFormSubmit(e){e.preventDefault(),e.stopImmediatePropagation(),this.error=null;const{login:t,password:o}=await e.target.getFormJson();try{this.loading=!0;const{name:e,email:s}=await apiFetch({method:"POST",path:"surecart/v1/login",data:{login:t,password:o}});this.scSetLoggedIn.emit(!0),this.scSetCustomer.emit({name:e,email:s}),this.open=!1}catch(e){console.error(e),this.error=(null==e?void 0:e.message)||wp.i18n.__("Something went wrong","surecart")}finally{this.loading=!1}}render(){return h(Host,{key:"a763c6b9213e0956cbffc957eb5437ea2deabffd"},!!this.notice&&h("sc-alert",{key:"e777c76f58e730844f1af07f335e889907b3a102",type:"success",open:!0,style:{marginBottom:"var(--sc-form-row-spacing)"},closable:!0},h("span",{key:"1f81a88f218bee201dc7fb6e4159c3b2520b87c0",slot:"title"},wp.i18n.__("Welcome back!","surecart")),wp.i18n.__("You have logged in successfully.","surecart")),h("slot",{key:"62be3a16c2d427dd195ae6f2717e1fe3d5c26c41"}),!this.loggedIn&&h("sc-dialog",{key:"13661d9b1392306d30939a86a7be1bf0b37a1734",label:wp.i18n.__("Login to your account","surecart"),open:this.open,onScRequestClose:()=>this.open=!1},h("sc-form",{key:"694e35ef08476e3cce5f0c5617ba096e817f79b4",ref:e=>this.loginForm=e,onScFormSubmit:e=>{e.preventDefault(),e.stopImmediatePropagation()},onScSubmit:e=>this.handleFormSubmit(e)},!!this.error&&h("sc-alert",{key:"0cfe2942095223c9e3e87b54f868c69ab38b2696",type:"danger",open:!!this.error},this.error),h("sc-input",{key:"53d7104a3aa67aba54e31e932b74008765f43ecf",label:wp.i18n.__("Email or Username","surecart"),type:"text",name:"login",required:!0,autofocus:this.open}),h("sc-input",{key:"77ddf7f0099f4c62bd5af9ebdfc273123b888a40",label:wp.i18n.__("Password","surecart"),type:"password",name:"password",required:!0}),h("sc-button",{key:"fa7141488876dce1c30aa80abdf49a8e56c4c15a",type:"primary",full:!0,loading:this.loading,submit:!0},wp.i18n.__("Login","surecart")))))}static get watchers(){return{open:["handleLoginDialogChange"],loggedIn:["handleLoggedInChange"],order:["handleOrderChange"]}}static get style(){return ScLoginProviderStyle0}},[1,"sc-login-provider",{loggedIn:[4,"logged-in"],order:[16],notice:[32],open:[32],loading:[32],error:[32]},[[0,"scLoginPrompt","handleLoginPrompt"]],{open:["handleLoginDialogChange"],loggedIn:["handleLoggedInChange"],order:["handleOrderChange"]}]);function defineCustomElement(){"undefined"!=typeof customElements&&["sc-login-provider","sc-alert","sc-button","sc-dialog","sc-form","sc-form-control","sc-icon","sc-input","sc-spinner","sc-visually-hidden"].forEach((e=>{switch(e){case"sc-login-provider":customElements.get(e)||customElements.define(e,ScLoginProvider);break;case"sc-alert":customElements.get(e)||defineCustomElement$9();break;case"sc-button":customElements.get(e)||defineCustomElement$8();break;case"sc-dialog":customElements.get(e)||defineCustomElement$7();break;case"sc-form":customElements.get(e)||defineCustomElement$6();break;case"sc-form-control":customElements.get(e)||defineCustomElement$5();break;case"sc-icon":customElements.get(e)||defineCustomElement$4();break;case"sc-input":customElements.get(e)||defineCustomElement$3();break;case"sc-spinner":customElements.get(e)||defineCustomElement$2();break;case"sc-visually-hidden":customElements.get(e)||defineCustomElement$1()}}))}export{ScLoginProvider as S,defineCustomElement as d};