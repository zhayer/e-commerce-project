{"version":3,"file":"sc-subscription-reactivate.js","sourceRoot":"","sources":["../../../../../src/components/controllers/dashboard/subscription-reactivate/sc-subscription-reactivate.tsx"],"names":[],"mappings":"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","sourcesContent":["import { Component, Event, EventEmitter, Fragment, Prop, State, Watch, h } from '@stencil/core';\nimport { __ } from '@wordpress/i18n';\nimport { Checkout, Period, Subscription } from 'src/types';\nimport apiFetch from '../../../../functions/fetch';\nimport { addQueryArgs } from '@wordpress/url';\n\n@Component({\n  tag: 'sc-subscription-reactivate',\n  shadow: true,\n})\nexport class ScSubscriptionReactivate {\n  /** Whether it is open */\n  @Prop() open: boolean;\n\n  /** The subscription to reactivate */\n  @Prop() subscription: Subscription;\n\n  /** Reactivate modal closed */\n  @Event({ cancelable: true }) scRequestClose: EventEmitter<'close-button' | 'keyboard' | 'overlay'>;\n\n  /** Refresh subscriptions */\n  @Event() scRefresh: EventEmitter<void>;\n\n  @State() busy: boolean;\n  @State() error: string;\n  @State() upcomingPeriod: Period;\n  @State() loading: boolean = false;\n\n  @Watch('open')\n  openChanged() {\n    if (this.open) {\n      this.fetchUpcoming();\n    }\n  }\n\n  async fetchUpcoming() {\n    this.loading = true;\n    try {\n      this.upcomingPeriod = await apiFetch({\n        method: 'PATCH',\n        path: addQueryArgs(`surecart/v1/subscriptions/${this.subscription?.id}/upcoming_period`, {\n          skip_product_group_validation: true,\n          expand: ['period.checkout'],\n        }),\n        data: {\n          purge_pending_update: false,\n        },\n      });\n    } catch (e) {\n      this.error = e?.message || __('Something went wrong', 'surecart');\n    } finally {\n      this.loading = false;\n    }\n  }\n\n  async reactivateSubscription() {\n    try {\n      this.error = '';\n      this.busy = true;\n      await apiFetch({\n        path: `surecart/v1/subscriptions/${this.subscription?.id}/restore`,\n        method: 'PATCH',\n      });\n      this.scRefresh.emit();\n      this.scRequestClose.emit('close-button');\n    } catch (e) {\n      this.error = e?.message || __('Something went wrong', 'surecart');\n    } finally {\n      this.busy = false;\n    }\n  }\n\n  renderLoading() {\n    return (\n      <sc-flex flexDirection=\"column\" style={{ gap: '1em' }}>\n        <sc-skeleton style={{ width: '20%', display: 'inline-block' }}></sc-skeleton>\n        <sc-skeleton style={{ width: '60%', display: 'inline-block' }}></sc-skeleton>\n        <sc-skeleton style={{ width: '40%', display: 'inline-block' }}></sc-skeleton>\n      </sc-flex>\n    );\n  }\n\n  render() {\n    return (\n      <sc-dialog noHeader open={this.open} style={{ '--width': '600px', '--body-spacing': 'var(--sc-spacing-xxx-large)' }}>\n        <sc-dashboard-module\n          loading={this.loading}\n          heading={__('Resubscribe', 'surecart')}\n          class=\"subscription-reactivate\"\n          error={this.error}\n          style={{ '--sc-dashboard-module-spacing': '1em' }}\n        >\n          {this.loading ? (\n            this.renderLoading()\n          ) : (\n            <Fragment>\n              <div slot=\"description\">\n                <sc-alert open type=\"warning\" title={__('Confirm Charge', 'surecart')}>\n                  {__('You will be charged', 'surecart')}{' '}\n                  <sc-format-number type=\"currency\" value={(this.upcomingPeriod?.checkout as Checkout)?.amount_due} currency={this.subscription?.currency}></sc-format-number>{' '}\n                  {__('immediately for your subscription.', 'surecart')}\n                </sc-alert>\n                <sc-text\n                  style={{\n                    '--font-size': 'var(--sc-font-size-medium)',\n                    '--color': 'var(--sc-input-label-color)',\n                    '--line-height': 'var(--sc-line-height-dense)',\n                    'margin-top': 'var(--sc-spacing-medium)',\n                  }}\n                >\n                  {__('Your subscription will be reactivated and will renew automatically on', 'surecart')} <strong>{this.upcomingPeriod?.end_at_date}</strong>\n                </sc-text>\n              </div>\n              <sc-flex justifyContent=\"flex-start\">\n                <sc-button type=\"primary\" loading={this.busy} disabled={this.busy} onClick={() => this.reactivateSubscription()}>\n                  {__('Yes, Reactivate', 'surecart')}\n                </sc-button>\n                <sc-button disabled={this.busy} style={{ color: 'var(--sc-color-gray-500)' }} type=\"text\" onClick={() => this.scRequestClose.emit()}>\n                  {__('No, Keep Inactive', 'surecart')}\n                </sc-button>\n              </sc-flex>\n            </Fragment>\n          )}\n          {this.busy && <sc-block-ui></sc-block-ui>}\n        </sc-dashboard-module>\n      </sc-dialog>\n    );\n  }\n}\n"]}