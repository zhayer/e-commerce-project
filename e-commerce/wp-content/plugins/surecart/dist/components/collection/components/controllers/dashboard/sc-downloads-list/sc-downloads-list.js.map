{"version":3,"file":"sc-downloads-list.js","sourceRoot":"","sources":["../../../../../src/components/controllers/dashboard/sc-downloads-list/sc-downloads-list.tsx"],"names":[],"mappings":"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","sourcesContent":["import { Component, h, Prop, State } from '@stencil/core';\nimport apiFetch from '../../../../functions/fetch';\nimport { __ } from '@wordpress/i18n';\nimport { addQueryArgs } from '@wordpress/url';\n\nimport { Download, Media } from '../../../../types';\n\n@Component({\n  tag: 'sc-downloads-list',\n  styleUrl: 'sc-downloads-list.scss',\n  shadow: true,\n})\nexport class ScDownloadsList {\n  @Prop() downloads: Download[];\n  @Prop() customerId: string;\n  @Prop() heading: string;\n  @State() busy: string;\n  @State() error: string;\n\n  async downloadItem(download) {\n    if (download?.url) {\n      this.downloadFile(download.url, download?.name ?? 'file');\n      return;\n    }\n\n    const mediaId = download?.media?.id;\n    if (!mediaId) return;\n\n    try {\n      this.busy = mediaId;\n      const media = (await apiFetch({\n        path: addQueryArgs(`surecart/v1/customers/${this.customerId}/expose/${mediaId}`, {\n          expose_for: 60,\n        }),\n      })) as Media;\n      if (!media?.url) {\n        throw {\n          message: __('Could not download the file.', 'surecart'),\n        };\n      }\n      this.downloadFile(media?.url, media.filename);\n    } catch (e) {\n      console.error(e);\n      this.error = e?.message || __('Something went wrong', 'surecart');\n    } finally {\n      this.busy = null;\n    }\n  }\n\n  downloadFile(path, filename) {\n    // Create a new link\n    const anchor = document.createElement('a');\n    anchor.href = path;\n    anchor.download = filename;\n\n    // Append to the DOM\n    document.body.appendChild(anchor);\n\n    // Trigger `click` event\n    anchor.click();\n\n    // To make this work on Firefox we need to wait\n    // a little while before removing it.\n    setTimeout(() => {\n      document.body.removeChild(anchor);\n    }, 0);\n  }\n\n  renderFileExt = download => {\n    if (download?.media?.filename) {\n      return download.media.filename.split?.('.')?.pop?.();\n    }\n    if (download?.url) {\n      try {\n        const url = new URL(download.url);\n        if (url.pathname.includes('.')) {\n          return url.pathname.split?.('.')?.pop?.();\n        }\n      } catch (err) {\n        console.error(err);\n      }\n    }\n    return <sc-icon name=\"file\" />;\n  };\n\n  render() {\n    const downloads = this.downloads || [];\n    return (\n      <sc-dashboard-module class=\"purchase\" part=\"base\" heading={__('Downloads', 'surecart')}>\n        <span slot=\"heading\">\n          <slot name=\"heading\">{this.heading || __('Downloads', 'surecart')}</slot>\n        </span>\n        <sc-card no-padding>\n          <sc-stacked-list>\n            {downloads.map(download => {\n              const media = download?.media as Media;\n              return (\n                <sc-stacked-list-row style={{ '--columns': '1' }}>\n                  <sc-flex class=\"single-download\" justifyContent=\"flex-start\" alignItems=\"center\">\n                    <div class=\"single-download__preview\">{this.renderFileExt(download)}</div>\n                    <div>\n                      <div>\n                        <strong>{media?.filename ?? download?.name ?? ''}</strong>\n                      </div>\n\n                      <sc-flex justifyContent=\"flex-start\" alignItems=\"center\" style={{ gap: '0.5em' }}>\n                        {media?.byte_size && <sc-format-bytes value={media.byte_size}></sc-format-bytes>}\n\n                        {!!media?.release_json?.version && (\n                          <sc-tag\n                            type=\"primary\"\n                            size=\"small\"\n                            style={{\n                              '--sc-tag-primary-background-color': '#f3e8ff',\n                              '--sc-tag-primary-color': '#6b21a8',\n                            }}\n                          >\n                            v{media?.release_json?.version}\n                          </sc-tag>\n                        )}\n                      </sc-flex>\n                    </div>\n                  </sc-flex>\n                  <sc-button\n                    size=\"small\"\n                    slot=\"suffix\"\n                    onClick={() => this.downloadItem(download)}\n                    busy={media?.id ? this.busy == media?.id : false}\n                    disabled={media?.id ? this.busy == media?.id : false}\n                  >\n                    {__('Download', 'surecart')}\n                  </sc-button>\n                </sc-stacked-list-row>\n              );\n            })}\n          </sc-stacked-list>\n        </sc-card>\n      </sc-dashboard-module>\n    );\n  }\n}\n"]}