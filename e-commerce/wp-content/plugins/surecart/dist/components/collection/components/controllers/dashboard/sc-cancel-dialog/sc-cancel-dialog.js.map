{"version":3,"file":"sc-cancel-dialog.js","sourceRoot":"","sources":["../../../../../src/components/controllers/dashboard/sc-cancel-dialog/sc-cancel-dialog.tsx"],"names":[],"mappings":"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","sourcesContent":["import { Component, Event, EventEmitter, h, Prop, State } from '@stencil/core';\nimport { __ } from '@wordpress/i18n';\nimport apiFetch from '../../../../functions/fetch';\n\nimport { CancellationReason, Subscription, SubscriptionProtocol } from '../../../../types';\n\n@Component({\n  tag: 'sc-cancel-dialog',\n  styleUrl: 'sc-cancel-dialog.scss',\n  shadow: true,\n})\nexport class ScCancelDialog {\n  @Prop() open: boolean;\n  @Prop() protocol: SubscriptionProtocol;\n  @Prop() subscription: Subscription;\n  @State() reasons: CancellationReason[];\n  @State() reason: CancellationReason;\n  @State() step: 'cancel' | 'survey' | 'discount' | 'discount-complete' = 'cancel';\n  @State() comment: string;\n  @Event({ cancelable: true }) scRequestClose: EventEmitter<'close-button' | 'keyboard' | 'overlay'>;\n  @Event() scRefresh: EventEmitter<void>;\n\n  close() {\n    this.reset();\n    this.trackAttempt();\n    this.scRequestClose.emit('close-button');\n  }\n\n  reset() {\n    this.reason = null;\n    this.step = this.protocol?.preservation_enabled ? 'survey' : 'cancel';\n  }\n\n  async trackAttempt() {\n    if (!this.protocol?.preservation_enabled) return;\n    await apiFetch({\n      method: 'PATCH',\n      path: `surecart/v1/subscriptions/${this.subscription?.id}/preserve`,\n    });\n  }\n\n  componentWillLoad() {\n    this.reset();\n  }\n\n  render() {\n    return (\n      <sc-dialog\n        style={{\n          '--width': this.step === 'survey' ? '675px' : '500px',\n          '--body-spacing': 'var(--sc-spacing-xxx-large)',\n        }}\n        noHeader\n        open={this.open}\n        onScRequestClose={() => this.close()}\n      >\n        <div\n          class={{\n            cancel: true,\n          }}\n        >\n          <sc-button class=\"close__button\" type=\"text\" circle onClick={() => this.close()}>\n            <sc-icon name=\"x\" />\n          </sc-button>\n\n          {this.step === 'cancel' && (\n            <sc-subscription-cancel\n              subscription={this.subscription}\n              protocol={this.protocol}\n              reason={this.reason}\n              comment={this.comment}\n              onScAbandon={() => this.close()}\n              onScCancelled={() => {\n                this.scRefresh.emit();\n                this.reset();\n                this.scRequestClose.emit('close-button');\n              }}\n            />\n          )}\n\n          {this.step === 'survey' && (\n            <sc-cancel-survey\n              protocol={this.protocol}\n              onScAbandon={() => this.close()}\n              onScSubmitReason={e => {\n                const { comment, reason } = e.detail;\n                this.reason = reason;\n                this.comment = comment;\n                this.step = reason?.coupon_enabled ? 'discount' : 'cancel';\n              }}\n            />\n          )}\n\n          {this.step === 'discount' && (\n            <sc-cancel-discount\n              protocol={this.protocol}\n              subscription={this.subscription}\n              reason={this.reason}\n              comment={this.comment}\n              onScCancel={() => (this.step = 'cancel')}\n              onScPreserved={() => {\n                this.scRefresh.emit();\n                this.reset();\n                this.scRequestClose.emit('close-button');\n              }}\n            />\n          )}\n        </div>\n      </sc-dialog>\n    );\n  }\n}\n"]}