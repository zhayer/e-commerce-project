{"version":3,"file":"sc-session-provider.js","sourceRoot":"","sources":["../../../../src/components/providers/session-provider/sc-session-provider.tsx"],"names":[],"mappings":"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","sourcesContent":["import { Component, Element, Event, EventEmitter, h, Listen, Method, Prop, Watch } from '@stencil/core';\nimport { state as checkoutState } from '@store/checkout';\nimport { clearCheckout } from '@store/checkout/mutations';\nimport { state as selectedProcessor } from '@store/selected-processor';\nimport { state as processorsState } from '@store/processors';\nimport { __ } from '@wordpress/i18n';\nimport { addQueryArgs, getQueryArg, getQueryArgs, removeQueryArgs } from '@wordpress/url';\nimport { updateFormState } from '@store/form/mutations';\n\nimport { parseFormData } from '../../../functions/form-data';\nimport { createCheckout, createOrUpdateCheckout, fetchCheckout, finalizeCheckout } from '../../../services/session';\nimport { Checkout, FormStateSetter, LineItemData, PriceChoice } from '../../../types';\nimport { createErrorNotice, createInfoNotice, removeNotice } from '@store/notices/mutations';\n\n@Component({\n  tag: 'sc-session-provider',\n  shadow: true,\n})\nexport class ScSessionProvider {\n  /** Element */\n  @Element() el: HTMLElement;\n\n  /** An array of prices to pre-fill in the form. */\n  @Prop() prices: Array<PriceChoice> = [];\n\n  /** Should we persist the session. */\n  @Prop() persist: boolean = true;\n\n  /** Update line items event */\n  @Event() scUpdateOrderState: EventEmitter<Checkout>;\n\n  /** Update line items event */\n  @Event() scUpdateDraftState: EventEmitter<Checkout>;\n\n  @Event() scPaid: EventEmitter<void>;\n\n  /** Set the state */\n  @Event() scSetState: EventEmitter<FormStateSetter>;\n\n  @Watch('prices')\n  handlePricesChange() {\n    let line_items = this.addInitialPrices() || [];\n    // line_items = this.addPriceChoices(line_items);\n    if (!line_items?.length) {\n      return;\n    }\n    return this.loadUpdate({ line_items });\n  }\n\n  /**\n   * Finalize the order.\n   *\n   * @returns {Promise<Order>}\n   */\n  @Method()\n  async finalize() {\n    return await this.handleFormSubmit();\n  }\n\n  async getFormData() {\n    let data = {};\n    const form = this.el.querySelector('sc-form');\n    if (form) {\n      const json = await form.getFormJson();\n      data = parseFormData(json);\n    }\n    return data;\n  }\n\n  /**\n   * Handles the form submission.\n   * @param e\n   */\n  @Listen('scFormSubmit')\n  async handleFormSubmit() {\n    removeNotice();\n\n    updateFormState('FINALIZE');\n\n    if (checkoutState?.checkout?.payment_method_required && selectedProcessor?.id === 'stripe' && processorsState.config.stripe.paymentElement) {\n      // not initialized.\n      if (!processorsState?.instances?.stripeElements) {\n        updateFormState('REJECT');\n        this.handleErrorResponse({ message: 'Stripe Elements not found.', code: 'stripe_elements_not_found' });\n        return new Error('Stripe Elements not found.');\n      }\n      // submit the elements.\n      const { error } = await processorsState?.instances?.stripeElements.submit();\n      if (error) {\n        console.error({ error });\n        updateFormState('REJECT');\n        createErrorNotice(error);\n        return;\n      }\n    }\n\n    // Get current form state.\n    let data = await this.getFormData();\n\n    if (window?.scData?.recaptcha_site_key && window?.grecaptcha) {\n      try {\n        data['grecaptcha'] = await window.grecaptcha.execute(window.scData.recaptcha_site_key, { action: 'surecart_checkout_submit' });\n      } catch (e) {\n        console.error(e);\n        updateFormState('REJECT');\n        this.handleErrorResponse(e);\n        return new Error(e?.message);\n      }\n    }\n\n    // first lets make sure the session is updated before we process it.\n    try {\n      await this.update(data);\n    } catch (e) {\n      console.error(e);\n      updateFormState('REJECT');\n      this.handleErrorResponse(e);\n    }\n\n    // first validate server-side and get key\n    try {\n      checkoutState.checkout = await finalizeCheckout({\n        id: checkoutState?.checkout?.id,\n        query: {\n          ...(selectedProcessor?.method ? { payment_method_type: selectedProcessor?.method } : {}),\n          return_url: addQueryArgs(window.location.href, {\n            ...(checkoutState?.checkout?.id ? { checkout_id: checkoutState?.checkout?.id } : {}),\n            is_surecart_payment_redirect: true,\n          }),\n        },\n        data,\n        processor: {\n          id: selectedProcessor.id,\n          manual: selectedProcessor.manual,\n        },\n      });\n\n      if (checkoutState.checkout?.payment_intent?.processor_data?.mollie?.checkout_url) {\n        updateFormState('PAYING');\n        return setTimeout(() => window.location.assign(checkoutState.checkout?.payment_intent?.processor_data?.mollie?.checkout_url), 50);\n      }\n\n      // the checkout is paid.\n      if (['paid', 'processing'].includes(checkoutState.checkout?.status)) {\n        this.scPaid.emit();\n      }\n\n      setTimeout(() => {\n        updateFormState('PAYING');\n      }, 50);\n\n      return checkoutState.checkout;\n    } catch (e) {\n      console.error(e);\n      this.handleErrorResponse(e);\n      return new Error(e?.message);\n    }\n  }\n\n  /**\n   * Handle paid event and update the\n   */\n  @Listen('scPaid')\n  async handlePaid() {\n    updateFormState('PAID');\n  }\n\n  @Listen('scUpdateAbandonedCart')\n  async handleAbandonedCartUpdate(e) {\n    const abandoned_checkout_enabled = e.detail;\n    this.loadUpdate({\n      abandoned_checkout_enabled,\n    });\n  }\n\n  /** Find or create session on load. */\n  componentDidLoad() {\n    this.findOrCreateOrder();\n  }\n\n  /** Find or create an order */\n  async findOrCreateOrder() {\n    // get URL params.\n    const { redirect_status, checkout_id, line_items, coupon, is_surecart_payment_redirect } = getQueryArgs(window.location.href);\n    // remove params we don't want.\n    window.history.replaceState(\n      {},\n      document.title,\n      removeQueryArgs(window.location.href, 'redirect_status', 'coupon', 'line_items', 'confirm_checkout_id', 'checkout_id', 'no_cart', 'is_surecart_payment_redirect'),\n    );\n\n    // handle abandoned checkout.\n    if (!!is_surecart_payment_redirect && !!checkout_id) {\n      updateFormState('FINALIZE');\n      updateFormState('PAYING');\n      return this.handleCheckoutIdFromUrl(checkout_id, coupon as string, {\n        refresh_status: true,\n      });\n    }\n\n    // handle redirect status.\n    if (!!redirect_status) {\n      return this.handleRedirectStatus(redirect_status, checkout_id);\n    }\n\n    // handle abandoned checkout.\n    if (!!checkout_id) {\n      return this.handleCheckoutIdFromUrl(checkout_id, coupon as string);\n    }\n\n    // handle initial line items.\n    if (!!line_items) {\n      return this.handleInitialLineItems(line_items, coupon as string);\n    }\n\n    // we have an existing saved checkout id in the session, and we are persisting.\n    const id = checkoutState?.checkout?.id;\n    if (id && this.persist) {\n      return this.handleExistingCheckout(id, coupon as string);\n    }\n\n    return this.handleNewCheckout(coupon as string);\n  }\n\n  /** Handle payment instrument redirect status */\n  async handleRedirectStatus(status, id) {\n    console.info('Handling payment redirect.');\n    // status failed.\n    if (status === 'failed') {\n      createErrorNotice(__('Payment unsuccessful. Please try again.', 'surecart'));\n      return;\n    }\n\n    // get the\n    if (!id) {\n      createErrorNotice(__('Could not find checkout. Please contact us before attempting to purchase again.', 'surecart'));\n      return;\n    }\n\n    // success, refetch the checkout\n    try {\n      updateFormState('FINALIZE');\n      checkoutState.checkout = (await fetchCheckout({\n        id,\n        query: {\n          refresh_status: true,\n        },\n      })) as Checkout;\n\n      // TODO: should we even check this?\n      if (checkoutState.checkout?.status && ['paid', 'processing'].includes(checkoutState.checkout?.status)) {\n        setTimeout(() => {\n          updateFormState('PAID');\n          this.scPaid.emit();\n        }, 100);\n      }\n    } catch (e) {\n      this.handleErrorResponse(e);\n    }\n  }\n\n  /** Handle abandoned checkout from URL */\n  async handleCheckoutIdFromUrl(id, promotion_code = '', query = {}) {\n    console.info('Handling existing checkout from url.', promotion_code, id);\n\n    // if coupon code, load the checkout with the code.\n    if (promotion_code) {\n      return this.loadUpdate({\n        id,\n        discount: { promotion_code },\n        refresh_line_items: true,\n        ...query,\n      });\n    }\n\n    try {\n      updateFormState('FETCH');\n      checkoutState.checkout = (await fetchCheckout({\n        id,\n        query: {\n          refresh_line_items: true,\n          ...query,\n        },\n      })) as Checkout;\n\n      updateFormState('RESOLVE');\n    } catch (e) {\n      this.handleErrorResponse(e);\n    }\n\n    // handle status.\n    switch (checkoutState.checkout?.status) {\n      case 'paid':\n      case 'processing':\n        return setTimeout(() => {\n          updateFormState('FINALIZE');\n          updateFormState('PAID');\n          this.scPaid.emit();\n        }, 100);\n\n      case 'payment_failed':\n        createErrorNotice({\n          message: __('Payment unsuccessful.', 'surecart'),\n        });\n        updateFormState('REJECT');\n        return;\n\n      case 'payment_intent_canceled':\n        updateFormState('REJECT');\n        return;\n      case 'canceled':\n        clearCheckout();\n        createErrorNotice({\n          message: __('Payment canceled. Please try again.', 'surecart'),\n        });\n        updateFormState('REJECT');\n        return;\n    }\n  }\n\n  /** Handle line items (and maybe ) */\n  async handleInitialLineItems(line_items, promotion_code) {\n    console.info('Handling initial line items.');\n    // TODO: move this to central store.\n    const address = this.el.querySelector('sc-order-shipping-address');\n    clearCheckout();\n    return this.loadUpdate({\n      line_items,\n      refresh_line_items: true,\n      ...(promotion_code ? { discount: { promotion_code } } : {}),\n      ...(address?.defaultCountry\n        ? {\n            shipping_address: {\n              country: address?.defaultCountry,\n            },\n          }\n        : {}),\n    });\n  }\n\n  /** Handle a brand new checkout. */\n  async handleNewCheckout(promotion_code) {\n    // get existing form data from defaults (default country selection, etc).\n    const data = this.getFormData();\n    let line_items = checkoutState.initialLineItems || [];\n    const address = this.el.querySelector('sc-order-shipping-address');\n\n    try {\n      updateFormState('FETCH');\n      checkoutState.checkout = (await createCheckout({\n        data: {\n          ...data,\n          ...(promotion_code ? { discount: { promotion_code } } : {}),\n          ...(address?.defaultCountry\n            ? {\n                shipping_address: {\n                  country: address?.defaultCountry,\n                },\n              }\n            : {}),\n          line_items,\n          ...(checkoutState.taxProtocol?.eu_vat_required ? { tax_identifier: { number_type: 'eu_vat' } } : {}),\n        },\n      })) as Checkout;\n      updateFormState('RESOLVE');\n    } catch (e) {\n      console.error(e);\n      this.handleErrorResponse(e);\n\n      // Handle any invalid coupon set on checkout URL.\n      if (e?.additional_errors?.[0]?.code === 'checkout.discount.coupon.blank') {\n        await this.handleNewCheckout(false);\n        createErrorNotice(e);\n      }\n    }\n  }\n\n  /** Handle existing checkout */\n  async handleExistingCheckout(id, promotion_code) {\n    if (!id) return this.handleNewCheckout(promotion_code);\n    console.info('Handling existing checkout.');\n    try {\n      updateFormState('FETCH');\n      checkoutState.checkout = (await createOrUpdateCheckout({\n        id,\n        data: {\n          ...(promotion_code ? { discount: { promotion_code } } : {}),\n          ...(checkoutState.taxProtocol?.eu_vat_required ? { tax_identifier: { number_type: 'eu_vat' } } : {}),\n          refresh_line_items: true,\n        },\n      })) as Checkout;\n      updateFormState('RESOLVE');\n    } catch (e) {\n      console.error(e);\n      this.handleErrorResponse(e);\n\n      // Handle any invalid coupon set on checkout URL.\n      if (e?.additional_errors?.[0]?.code === 'checkout.discount.coupon.blank') {\n        await this.handleExistingCheckout(id, false);\n        createErrorNotice(e);\n      }\n    }\n  }\n\n  /** Handle the error response. */\n  async handleErrorResponse(e) {\n    // reinitalize if order not found.\n    if (['checkout.not_found'].includes(e?.code)) {\n      clearCheckout();\n      return this.handleNewCheckout(false);\n    }\n\n    if (['test_mode_restricted'].includes(e?.code)) {\n      updateFormState('TEST_MODE_RESTRICTED');\n      return;\n    }\n\n    const hasPriceVersionChangeError = (e?.additional_errors || []).some(error => {\n      const purchasableStatuses = error?.data?.options?.purchasable_statuses || [];\n      return ['price_old_version', 'variant_old_version'].some(status => purchasableStatuses.includes(status));\n    });\n\n    if (hasPriceVersionChangeError) {\n      await this.loadUpdate({\n        id: checkoutState?.checkout?.id,\n        refresh_line_items: true,\n        status: 'draft',\n      });\n      createInfoNotice(\n        e?.additional_errors?.[0]?.message ||\n          __('Some products in your order were outdated and have been updated. Please review your order summary before proceeding to payment.', 'surecart'),\n      );\n      updateFormState('REJECT');\n      return;\n    }\n\n    // If got Product out of stock error, then fetch the checkout again.\n    if (e?.additional_errors?.[0]?.code === 'checkout.product.out_of_stock') {\n      this.fetch();\n      updateFormState('REJECT');\n      return;\n    }\n\n    if (['order.invalid_status_transition'].includes(e?.code)) {\n      await this.loadUpdate({\n        id: checkoutState?.checkout?.id,\n        status: 'draft',\n      });\n      this.handleFormSubmit();\n      return;\n    }\n\n    // expired\n    if (e?.code === 'rest_cookie_invalid_nonce') {\n      updateFormState('EXPIRE');\n      return;\n    }\n\n    // paid\n    if (e?.code === 'readonly') {\n      clearCheckout();\n      window.location.assign(removeQueryArgs(window.location.href, 'order'));\n      return;\n    }\n\n    createErrorNotice(e);\n    updateFormState('REJECT');\n  }\n\n  /** Looks through children and finds items needed for initial session. */\n  async initialize(args = {}) {\n    let line_items = checkoutState.initialLineItems || [];\n    return this.loadUpdate({ ...(line_items?.length ? { line_items } : {}), ...args });\n  }\n\n  /** Add prices that are passed into the component. */\n  addInitialPrices() {\n    if (!this?.prices?.length) return [];\n\n    // check for id\n    if (this.prices.some(p => !p?.id)) {\n      return;\n    }\n\n    // add prices that are passed into this component.\n    return this.prices.map(price => {\n      return {\n        price_id: price.id,\n        quantity: price.quantity,\n        variant: price.variant,\n      };\n    });\n  }\n\n  // /** Add default prices that may be selected in form. */\n  // addPriceChoices(line_items = []) {\n  //   // const elements = this.el.querySelectorAll('[price-id]') as any;\n  //   // elements.forEach(el => {\n  //   //   // handle price choices.\n  //   //   if (el.checked) {\n  //   //     line_items.push({\n  //   //       quantity: el.quantity || 1,\n  //   //       price_id: el.priceId,\n  //   //       ...(el.defaultAmount ? { ad_hoc_amount: el.defaultAmount } : {}),\n  //   //     });\n  //   //   }\n  //   //   // handle donation default amount.\n  //   //   if (el.defaultAmount) {\n  //   //     line_items.push({\n  //   //       quantity: el.quantity || 1,\n  //   //       price_id: el.priceId,\n  //   //       ad_hoc_amount: el.defaultAmount,\n  //   //     });\n  //   //   }\n  //   // });\n  //   // return line_items;\n  // }\n\n  getSessionId() {\n    // check url first.\n    const checkoutId = getQueryArg(window.location.href, 'checkout_id');\n    if (!!checkoutId) {\n      return checkoutId;\n    }\n\n    // check existing order.\n    if (checkoutState?.checkout?.id) {\n      return checkoutState?.checkout?.id;\n    }\n\n    // we don't have and order id.\n    return null;\n  }\n\n  async fetchCheckout(id, { query = {}, data = {} } = {}) {\n    try {\n      updateFormState('FETCH');\n      const checkout = (await createOrUpdateCheckout({\n        id,\n        query,\n        data,\n      })) as Checkout;\n      updateFormState('RESOLVE');\n      return checkout;\n    } catch (e) {\n      this.handleErrorResponse(e);\n    }\n  }\n\n  /** Fetch a session. */\n  async fetch(query = {}) {\n    try {\n      updateFormState('FETCH');\n      checkoutState.checkout = (await fetchCheckout({\n        id: this.getSessionId(),\n        query,\n      })) as Checkout;\n      updateFormState('RESOLVE');\n    } catch (e) {\n      this.handleErrorResponse(e);\n    }\n  }\n\n  /** Update a session */\n  async update(data: any = {}, query = {}) {\n    try {\n      checkoutState.checkout = (await createOrUpdateCheckout({\n        id: data?.id ? data.id : this.getSessionId(),\n        data,\n        query,\n      })) as Checkout;\n    } catch (e) {\n      // reinitalize if order not found.\n      if (['checkout.not_found'].includes(e?.code)) {\n        clearCheckout();\n        return this.initialize();\n      }\n      console.error(e);\n      throw e;\n    }\n  }\n\n  /** Updates a session with loading status changes. */\n  async loadUpdate(data = {}) {\n    try {\n      updateFormState('FETCH');\n      await this.update(data);\n      updateFormState('RESOLVE');\n    } catch (e) {\n      this.handleErrorResponse(e);\n    }\n  }\n\n  render() {\n    return (\n      <sc-line-items-provider order={checkoutState?.checkout} onScUpdateLineItems={e => this.loadUpdate({ line_items: e.detail as Array<LineItemData> })}>\n        <slot />\n      </sc-line-items-provider>\n    );\n  }\n}\n"]}