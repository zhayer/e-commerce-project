{"version":3,"file":"sc-mollie-add-method.js","sourceRoot":"","sources":["../../../../src/components/ui/sc-mollie-add-method/sc-mollie-add-method.tsx"],"names":[],"mappings":"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","sourcesContent":["import { Component, h, Prop, State } from '@stencil/core';\nimport { sprintf, __ } from '@wordpress/i18n';\nimport { addQueryArgs } from '@wordpress/url';\nimport { Pagination, PaymentIntent, PaymentMethodType } from 'src/types';\nimport apiFetch from '../../../functions/fetch';\n\n@Component({\n  tag: 'sc-mollie-add-method',\n  styleUrl: 'sc-mollie-add-method.css',\n  shadow: true,\n})\nexport class ScMollieAddMethod {\n  @Prop() country: string;\n  @Prop() successUrl: string;\n  @Prop() processorId: string;\n  @Prop() currency: string;\n  @Prop() liveMode: boolean;\n  @Prop() customerId: string;\n\n  @State() methods: PaymentMethodType[] = [];\n  @State() loading: boolean;\n  @State() error: string;\n  @State() selectedMethodId: string;\n  @State() paymentIntent: PaymentIntent;\n\n  componentWillLoad() {\n    this.fetchMethods();\n  }\n\n  async createPaymentIntent() {\n    try {\n      this.loading = true;\n      this.error = '';\n      this.paymentIntent = await apiFetch({\n        method: 'POST',\n        path: 'surecart/v1/payment_intents',\n        data: {\n          processor_type: 'mollie',\n          live_mode: this.liveMode,\n          customer_id: this.customerId,\n          return_url: this.successUrl,\n          payment_method_type: this.selectedMethodId,\n          currency: this.currency,\n          refresh_status: true,\n        },\n      });\n      if (this.paymentIntent.processor_data?.mollie?.checkout_url) {\n        window.location.assign(this.paymentIntent.processor_data?.mollie?.checkout_url);\n      }\n    } catch (e) {\n      console.error(e);\n      this.error = e?.message || __('Something went wrong', 'surecart');\n      this.loading = false;\n    }\n  }\n\n  async fetchMethods() {\n    try {\n      this.loading = true;\n      const response = (await apiFetch({\n        path: addQueryArgs(`surecart/v1/processors/${this.processorId}/payment_method_types`, {\n          amount: 2500,\n          country: this.country,\n          currency: this.currency,\n          reusable: true,\n        }),\n      })) as {\n        object: 'list';\n        pagination: Pagination;\n        data: PaymentMethodType[];\n      };\n      this.methods = response?.data || [];\n      if (this.methods?.length) {\n        this.selectedMethodId = this.methods?.[0]?.id;\n      }\n    } catch (e) {\n      this.error = e?.message || __('Something went wrong', 'surecart');\n      console.error(e);\n    } finally {\n      this.loading = false;\n    }\n  }\n\n  handleSubmit() {\n    this.createPaymentIntent();\n  }\n\n  renderLoading() {\n    return (\n      <sc-card>\n        <sc-skeleton style={{ width: '50%', marginBottom: '0.5em' }}></sc-skeleton>\n        <sc-skeleton style={{ width: '30%', marginBottom: '0.5em' }}></sc-skeleton>\n        <sc-skeleton style={{ width: '60%', marginBottom: '0.5em' }}></sc-skeleton>\n      </sc-card>\n    );\n  }\n\n  render() {\n    if (this.loading && !this.methods?.length) {\n      return this.renderLoading();\n    }\n\n    return (\n      <sc-form onScFormSubmit={() => this.handleSubmit()} style={{ position: 'relative' }}>\n        <sc-toggles collapsible={false} theme=\"container\">\n          {(this.methods || []).map(method => (\n            <sc-toggle show-control shady borderless open={this.selectedMethodId === method?.id} onScShow={() => (this.selectedMethodId = method?.id)}>\n              <span slot=\"summary\" class=\"sc-payment-toggle-summary\">\n                {!!method?.image && <img src={method?.image} />}\n                <span>{method?.description}</span>\n              </span>\n\n              <sc-card>\n                <sc-payment-selected label={sprintf(__('%s selected.', 'surecart'), method?.description)}>\n                  {!!method?.image && <img slot=\"icon\" src={method?.image} style={{ width: '32px' }} />}\n                  {__('Another step will appear after submitting your order to add this payment method.', 'surecart')}\n                </sc-payment-selected>\n              </sc-card>\n            </sc-toggle>\n          ))}\n        </sc-toggles>\n        <sc-button type=\"primary\" submit full loading={this.loading}>\n          {__('Add Payment Method', 'surecart')}\n        </sc-button>\n        {this.loading && <sc-block-ui z-index={9} style={{ '--sc-block-ui-opacity': '0.75' }} />}\n      </sc-form>\n    );\n  }\n}\n"]}