{"version":3,"file":"sc-order-coupon-form.js","sourceRoot":"","sources":["../../../../../src/components/controllers/checkout-form/order-coupon-form/sc-order-coupon-form.tsx"],"names":[],"mappings":"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","sourcesContent":["import { Component, State, h, Prop } from '@stencil/core';\nimport { state as checkoutState } from '@store/checkout';\nimport { __ } from '@wordpress/i18n';\nimport { isRtl } from '../../../../functions/page-align';\nimport { formBusy } from '@store/form/getters';\nimport { createOrUpdateCheckout } from '@services/session';\nimport { Checkout } from 'src/types';\nimport { updateFormState } from '@store/form/mutations';\n\n@Component({\n  tag: 'sc-order-coupon-form',\n  styleUrl: 'sc-order-coupon-form.scss',\n  shadow: true,\n})\nexport class ScOrderCouponForm {\n  private couponForm: HTMLScCouponFormElement;\n  @Prop() label: string;\n  @Prop() loading: boolean;\n  @Prop() collapsed: boolean;\n  @Prop() placeholder: string;\n  @Prop() buttonText: string;\n\n  @State() open: boolean;\n  @State() value: string;\n  @State() error: string;\n\n  async handleCouponApply(e) {\n    const promotion_code = e?.detail || null;\n\n    try {\n      this.error = null;\n      updateFormState('FETCH');\n\n      checkoutState.checkout = (await createOrUpdateCheckout({\n        id: checkoutState.checkout.id,\n        data: {\n          discount: {\n            ...(promotion_code ? { promotion_code } : {}),\n          },\n        },\n      })) as Checkout;\n\n      updateFormState('RESOLVE');\n      await this.couponForm?.triggerFocus();\n    } catch (error) {\n      console.error(error);\n      this.error = error?.additional_errors?.[0]?.message || error?.message || __('Something went wrong', 'surecart');\n      updateFormState('REJECT');\n    }\n  }\n\n  render() {\n    // Do any line items have a recurring price?\n    const hasRecurring = checkoutState?.checkout?.line_items?.data?.some(item => item?.price?.recurring_interval);\n\n    return (\n      <sc-coupon-form\n        ref={el => (this.couponForm = el as HTMLScCouponFormElement)}\n        label={this.label || __('Add Coupon Code', 'surecart')}\n        collapsed={this.collapsed}\n        placeholder={this.placeholder}\n        loading={formBusy() && !checkoutState.checkout?.line_items?.data?.length}\n        busy={formBusy()}\n        discount={checkoutState.checkout?.discount}\n        currency={checkoutState.checkout?.currency}\n        discount-amount={checkoutState.checkout?.discount_amount}\n        class={{\n          'order-coupon-form--is-rtl': isRtl(),\n        }}\n        button-text={this.buttonText || __('Apply', 'surecart')}\n        show-interval={hasRecurring}\n        onScApplyCoupon={e => this.handleCouponApply(e)}\n        error={this.error}\n      ></sc-coupon-form>\n    );\n  }\n}\n"]}