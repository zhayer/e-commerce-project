{"version":3,"file":"sc-subscription-cancel.js","sourceRoot":"","sources":["../../../../../src/components/controllers/dashboard/subscription-cancel/sc-subscription-cancel.tsx"],"names":[],"mappings":"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","sourcesContent":["import { Component, Event, EventEmitter, Fragment, h, Prop, State } from '@stencil/core';\nimport { __ } from '@wordpress/i18n';\nimport { addQueryArgs } from '@wordpress/url';\nimport apiFetch from '../../../../functions/fetch';\nimport { CancellationReason, SubscriptionProtocol } from '../../../../types';\nimport { Subscription } from '../../../../types';\n\n@Component({\n  tag: 'sc-subscription-cancel',\n  styleUrl: 'sc-subscription-cancel.scss',\n  shadow: true,\n})\nexport class ScSubscriptionCancel {\n  @Prop() heading: string;\n  @Prop() backUrl: string;\n  @Prop() successUrl: string;\n  @Prop() subscription: Subscription;\n  @Prop() protocol: SubscriptionProtocol;\n  @Prop() reason: CancellationReason;\n  @Prop() comment: string;\n  @State() loading: boolean;\n  @State() busy: boolean;\n  @State() error: string;\n  @Event() scAbandon: EventEmitter<void>;\n  @Event() scCancelled: EventEmitter<void>;\n\n  async cancelSubscription() {\n    try {\n      this.error = '';\n      this.busy = true;\n      await apiFetch({\n        path: addQueryArgs(`/surecart/v1/subscriptions/${this.subscription?.id}/cancel`, {\n          cancellation_act: {\n            ...(!!this.comment ? { comment: this.comment } : {}),\n            cancellation_reason_id: this.reason?.id,\n          },\n        }),\n        method: 'PATCH',\n      });\n      this.scCancelled.emit();\n    } catch (e) {\n      this.error = e?.message || __('Something went wrong', 'surecart');\n      this.busy = false;\n    }\n  }\n\n  renderContent() {\n    if (this.loading) {\n      return this.renderLoading();\n    }\n\n    return (\n      <Fragment>\n        {this?.protocol?.cancel_behavior === 'pending' ? (\n          <div slot=\"description\">\n            {__('Your plan will be canceled, but is still available until the end of your billing period on', 'surecart')}{' '}\n            <strong>{this?.subscription?.current_period_end_at_date}</strong>. {__('If you change your mind, you can renew your subscription.', 'surecart')}\n          </div>\n        ) : (\n          <div slot=\"description\">{__('Your plan will be canceled immediately and cannot be modified later.', 'surecart')}</div>\n        )}\n      </Fragment>\n    );\n  }\n\n  renderLoading() {\n    return (\n      <div style={{ padding: '0.5em' }}>\n        <sc-skeleton style={{ width: '30%', marginBottom: '0.75em' }}></sc-skeleton>\n        <sc-skeleton style={{ width: '20%', marginBottom: '0.75em' }}></sc-skeleton>\n        <sc-skeleton style={{ width: '40%' }}></sc-skeleton>\n      </div>\n    );\n  }\n\n  render() {\n    return (\n      <sc-dashboard-module\n        heading={this.heading || __('Cancel your plan', 'surecart')}\n        class=\"subscription-cancel\"\n        error={this.error}\n        style={{ '--sc-dashboard-module-spacing': '1em' }}\n      >\n        {this.renderContent()}\n\n        <sc-flex justifyContent=\"flex-start\">\n          <sc-button type=\"primary\" loading={this.loading || this.busy} disabled={this.loading || this.busy} onClick={() => this.cancelSubscription()}>\n            {__('Cancel Plan', 'surecart')}\n          </sc-button>\n\n          <sc-button\n            style={{ color: 'var(--sc-color-gray-500' }}\n            type=\"text\"\n            onClick={() => this.scAbandon.emit()}\n            loading={this.loading || this.busy}\n            disabled={this.loading || this.busy}\n          >\n            {__('Keep My Plan', 'surecart')}\n          </sc-button>\n        </sc-flex>\n\n        {this.busy && <sc-block-ui></sc-block-ui>}\n      </sc-dashboard-module>\n    );\n  }\n}\n"]}