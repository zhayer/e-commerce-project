{"version":3,"file":"sc-order-bump.js","sourceRoot":"","sources":["../../../../../src/components/controllers/checkout-form/sc-order-bump/sc-order-bump.tsx"],"names":[],"mappings":"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","sourcesContent":["import { Component, h, Prop } from '@stencil/core';\nimport { sprintf, __ } from '@wordpress/i18n';\nimport { speak } from '@wordpress/a11y';\nimport { getFormattedPrice, intervalString } from '../../../../functions/price';\nimport { state as checkoutState } from '@store/checkout';\n\nimport { Bump, Price, Product } from '../../../../types';\nimport { addCheckoutLineItem, removeCheckoutLineItem, trackOrderBump } from '@store/checkout/mutations';\n\n@Component({\n  tag: 'sc-order-bump',\n  styleUrl: 'sc-order-bump.scss',\n  shadow: true,\n})\nexport class ScOrderBump {\n  /** The bump */\n  @Prop() bump: Bump;\n\n  /** Should we show the controls */\n  @Prop({ reflect: true }) showControl: boolean;\n\n  /** The bump line item */\n  lineItem() {\n    return checkoutState?.checkout?.line_items?.data?.find(item => item?.bump === this.bump?.id);\n  }\n\n  /** Update the line item. */\n  updateLineItem() {\n    const price = (this.bump.price as Price)?.id || (this.bump?.price as string);\n\n    if (this.lineItem()) {\n      removeCheckoutLineItem(this.lineItem()?.id);\n      speak(__('Order bump Removed.', 'surecart'));\n      return;\n    }\n\n    addCheckoutLineItem({\n      bump: this.bump?.id,\n      price,\n      quantity: 1,\n    });\n    speak(__('Order bump applied.', 'surecart'));\n  }\n\n  componentDidLoad() {\n    trackOrderBump(this.bump?.id);\n  }\n\n  newPrice() {\n    let amount = null;\n    let initialAmount = (this.bump?.price as Price)?.amount || 0;\n\n    if (this.bump?.amount_off) {\n      amount = Math.max(0, initialAmount - this.bump?.amount_off);\n    }\n    if (this.bump?.percent_off) {\n      const off = initialAmount * (this.bump?.percent_off / 100);\n      amount = Math.max(0, initialAmount - off);\n    }\n\n    return amount;\n  }\n\n  renderInterval() {\n    const interval = intervalString(this.bump?.price as Price, { labels: { interval: '/', period: __('for', 'surecart') } });\n    if (!interval.trim().length) return null;\n    return <span class=\"bump__interval\">{interval}</span>;\n  }\n\n  renderPrice() {\n    return (\n      <div slot=\"description\" class={{ 'bump__price': true, 'bump__price--has-discount': !!this.bump?.percent_off || !!this.bump?.amount_off }} part=\"price\">\n        <span\n          aria-label={\n            /** translators: %s: old price */\n            sprintf(\n              __('Originally priced at %s.', 'surecart'),\n              getFormattedPrice({\n                amount: (this.bump?.price as Price)?.amount,\n                currency: (this.bump?.price as Price)?.currency,\n              }),\n            )\n          }\n        >\n          <sc-format-number\n            type=\"currency\"\n            class=\"bump__original-price\"\n            value={(this.bump?.price as Price)?.amount}\n            currency={(this.bump?.price as Price)?.currency}\n          ></sc-format-number>{' '}\n        </span>\n        <span>\n          <span aria-hidden=\"true\">\n            {this.newPrice() === 0 && __('Free', 'surecart')}\n            {this.newPrice() !== null && this.newPrice() > 0 && (\n              <sc-format-number type=\"currency\" class=\"bump__new-price\" value={this.newPrice()} currency={(this.bump?.price as Price).currency} />\n            )}\n            {this.renderInterval()}\n          </span>\n        </span>\n      </div>\n    );\n  }\n\n  renderDiscount() {\n    if (!!this.bump?.amount_off) {\n      return (\n        <div\n          class=\"bump__tag\"\n          aria-label={\n            /** translators: %1$s: amount off, %2$s: currency */\n            sprintf(__('You save %1$s%2$s.', 'surecart'), this.bump?.amount_off, (this.bump?.price as Price).currency)\n          }\n        >\n          <span aria-hidden=\"true\">\n            {__('Save', 'surecart')} <sc-format-number type=\"currency\" value={this.bump?.amount_off} currency={(this.bump?.price as Price).currency}></sc-format-number>\n          </span>\n        </div>\n      );\n    }\n\n    if (!!this.bump?.percent_off) {\n      return (\n        <div\n          class=\"bump__tag\"\n          aria-label={\n            /** translators: %s: amount percent off */\n            sprintf(__('You save %s%%.', 'surecart'), this.bump?.percent_off)\n          }\n        >\n          <span aria-hidden=\"true\">{sprintf(__('Save %s%%', 'surecart'), this.bump?.percent_off)}</span>\n        </div>\n      );\n    }\n  }\n\n  render() {\n    const product = (this.bump?.price as Price)?.product as Product;\n    return (\n      <sc-choice\n        value={this.bump?.id}\n        type=\"checkbox\"\n        showControl={this.showControl}\n        checked={!!this.lineItem()}\n        onClick={e => {\n          e.preventDefault();\n          e.stopImmediatePropagation();\n          this.updateLineItem();\n        }}\n        onKeyDown={e => {\n          if (e.key === 'Enter' || e.key === ' ') {\n            e.preventDefault();\n            e.stopImmediatePropagation();\n            this.updateLineItem();\n          }\n        }}\n        exportparts=\"base, control, checked-icon, title\"\n      >\n        <div part=\"base-content\" class=\"bump\">\n          <div class=\"bump__text\">\n            <div\n              class=\"bump__title\"\n              aria-label={sprintf(\n                /* translators: %s: order bump name */\n                __('Product: %s.', 'surecart'),\n                this.bump?.metadata?.cta || this.bump?.name || product?.name,\n              )}\n            >\n              <span aria-hidden=\"true\">{this.bump?.metadata?.cta || this.bump?.name || product?.name}</span>\n            </div>\n            <div class=\"bump__amount\">\n              <span>{this.renderPrice()}</span>\n              <span>{this.renderDiscount()}</span>\n            </div>\n          </div>\n        </div>\n\n        {this.bump?.metadata?.description && (\n          <div slot=\"footer\" class=\"bump__product--wrapper\">\n            <sc-divider style={{ '--spacing': 'var(--sc-spacing-medium)' }}></sc-divider>\n            <div class=\"bump__product\">\n              {!!product?.line_item_image?.src && <img {...(product?.line_item_image as any)} class=\"bump__image\" />}\n              <div class=\"bump__product-text\">\n                {!!this.bump?.metadata?.cta && (\n                  <div class=\"bump__product-title\" aria-hidden=\"true\">\n                    {this.bump.name || product?.name}\n                  </div>\n                )}\n\n                {!!this.bump?.metadata?.description && (\n                  <div\n                    class=\"bump__product-description\"\n                    aria-label={sprintf(\n                      /* translators: %s: Product description */\n                      __('Product description: %s.', 'surecart'),\n                      this.bump?.metadata?.description,\n                    )}\n                  >\n                    <span aria-hidden=\"true\">{this.bump?.metadata?.description}</span>\n                  </div>\n                )}\n              </div>\n            </div>\n          </div>\n        )}\n      </sc-choice>\n    );\n  }\n}\n"]}