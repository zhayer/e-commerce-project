{"version":3,"file":"sc-purchase-downloads-list.js","sourceRoot":"","sources":["../../../../src/components/ui/purchase-downloads-list/sc-purchase-downloads-list.tsx"],"names":[],"mappings":"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","sourcesContent":["import { Component, Element, Fragment, h, Prop } from '@stencil/core';\nimport { __, _n, sprintf } from '@wordpress/i18n';\nimport { addQueryArgs } from '@wordpress/url';\nimport { Download, Media, Product, Purchase } from '../../../types';\n\n@Component({\n  tag: 'sc-purchase-downloads-list',\n  styleUrl: 'sc-purchase-downloads-list.scss',\n  shadow: true,\n})\nexport class ScPurchaseDownloadsList {\n  @Element() el: HTMLScDownloadsListElement;\n\n  @Prop() allLink: string;\n  @Prop() heading: string;\n  @Prop() busy: boolean;\n  @Prop() loading: boolean;\n  @Prop() requestNonce: string;\n  @Prop() error: string;\n  @Prop() purchases: Array<Purchase> = [];\n\n  renderEmpty() {\n    return (\n      <div>\n        <sc-divider style={{ '--spacing': '0' }}></sc-divider>\n        <slot name=\"empty\">\n          <sc-empty icon=\"download\">{__(\"You don't have any downloads.\", 'surecart')}</sc-empty>\n        </slot>\n      </div>\n    );\n  }\n\n  renderLoading() {\n    return (\n      <sc-card no-padding style={{ '--overflow': 'hidden' }}>\n        <sc-stacked-list>\n          <sc-stacked-list-row style={{ '--columns': '2' }} mobile-size={0}>\n            <div style={{ padding: '0.5em' }}>\n              <sc-skeleton style={{ width: '30%', marginBottom: '0.75em' }}></sc-skeleton>\n              <sc-skeleton style={{ width: '20%' }}></sc-skeleton>\n            </div>\n          </sc-stacked-list-row>\n        </sc-stacked-list>\n      </sc-card>\n    );\n  }\n\n  renderList() {\n    return this.purchases.map(purchase => {\n      const downloads = (purchase?.product as Product)?.downloads?.data.filter((d: Download) => !d.archived);\n      const mediaBytesList = (downloads || []).map(item => (item?.media ? (item?.media as Media)?.byte_size : 0));\n      const mediaByteTotalSize = mediaBytesList.reduce((prev, curr) => prev + curr, 0);\n\n      return (\n        <sc-stacked-list-row\n          href={\n            !purchase?.revoked\n              ? addQueryArgs(window.location.href, {\n                  action: 'show',\n                  model: 'download',\n                  id: purchase.id,\n                  nonce: this.requestNonce,\n                })\n              : null\n          }\n          key={purchase.id}\n          mobile-size={0}\n        >\n          <sc-spacing\n            style={{\n              '--spacing': 'var(--sc-spacing-xx--small)',\n            }}\n          >\n            <div>\n              <strong>{(purchase?.product as Product)?.name}</strong>\n            </div>\n            <div class=\"download__details\">\n              {sprintf(_n('%s file', '%s files', downloads?.length, 'surecart'), downloads?.length)}\n              {!!mediaByteTotalSize && (\n                <Fragment>\n                  {' '}\n                  &bull; <sc-format-bytes value={mediaByteTotalSize}></sc-format-bytes>\n                </Fragment>\n              )}\n            </div>\n          </sc-spacing>\n\n          <sc-icon name=\"chevron-right\" slot=\"suffix\"></sc-icon>\n        </sc-stacked-list-row>\n      );\n    });\n  }\n\n  renderContent() {\n    if (this.loading) {\n      return this.renderLoading();\n    }\n\n    if (this.purchases?.length === 0) {\n      return this.renderEmpty();\n    }\n\n    return (\n      <sc-card no-padding style={{ '--overflow': 'hidden' }}>\n        <sc-stacked-list>{this.renderList()}</sc-stacked-list>\n      </sc-card>\n    );\n  }\n\n  render() {\n    return (\n      <sc-dashboard-module class=\"downloads-list\" error={this.error}>\n        <span slot=\"heading\">\n          <slot name=\"heading\">{this.heading || __('Items', 'surecart')}</slot>\n        </span>\n\n        <slot name=\"before\"></slot>\n\n        {!!this.allLink && (\n          <sc-button type=\"link\" href={this.allLink} slot=\"end\">\n            {__('View all', 'surecart')}\n            <sc-icon name=\"chevron-right\" slot=\"suffix\"></sc-icon>\n          </sc-button>\n        )}\n\n        {this.renderContent()}\n\n        <slot name=\"after\"></slot>\n\n        {this.busy && <sc-block-ui></sc-block-ui>}\n      </sc-dashboard-module>\n    );\n  }\n}\n"]}