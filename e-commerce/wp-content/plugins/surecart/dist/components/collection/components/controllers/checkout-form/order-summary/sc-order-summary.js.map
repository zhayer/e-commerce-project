{"version":3,"file":"sc-order-summary.js","sourceRoot":"","sources":["../../../../../src/components/controllers/checkout-form/order-summary/sc-order-summary.tsx"],"names":[],"mappings":"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","sourcesContent":["import { Component, Element, Event, EventEmitter, h, Prop, Watch } from '@stencil/core';\nimport { __, sprintf } from '@wordpress/i18n';\nimport { speak } from '@wordpress/a11y';\n\nimport { state as checkoutState } from '@store/checkout';\nimport { formBusy, formLoading } from '@store/form/getters';\nimport { animateTo, shimKeyframesHeightAuto, stopAnimations } from '../../../../functions/animate';\nimport { getAnimation, setDefaultAnimation } from '../../../../functions/animation-registry';\nimport { Checkout, Invoice } from '../../../../types';\n\n@Component({\n  tag: 'sc-order-summary',\n  styleUrl: 'sc-order-summary.scss',\n  shadow: true,\n})\nexport class ScOrderSummary {\n  private body: HTMLElement;\n  @Element() el: HTMLScOrderSummaryElement;\n  @Prop() order: Checkout;\n  @Prop() busy: boolean;\n  @Prop() orderSummaryText: string = __('Summary', 'surecart');\n  @Prop() invoiceSummaryText: string = __('Invoice Summary', 'surecart');\n  @Prop() collapsible: boolean = false;\n  @Prop() collapsedOnMobile: boolean = false;\n  @Prop() collapsedOnDesktop: boolean;\n\n  @Prop({ mutable: true }) collapsed: boolean = false;\n\n  /** Show the toggle */\n  @Event() scShow: EventEmitter<void>;\n\n  /** Show the toggle */\n  @Event() scHide: EventEmitter<void>;\n\n  isMobileScreen(): boolean {\n    const bodyRect = document.body?.getClientRects();\n    return bodyRect?.length && bodyRect[0]?.width < 781;\n  }\n\n  componentWillLoad() {\n    if (this.isMobileScreen()) {\n      this.collapsed = this.collapsed || this.collapsedOnMobile;\n    } else {\n      this.collapsed = this.collapsed || this.collapsedOnDesktop;\n    }\n\n    this.handleOpenChange();\n  }\n\n  handleClick(e) {\n    e.preventDefault();\n    if (this.empty() && !formBusy()) return;\n    this.collapsed = !this.collapsed;\n  }\n\n  /** It's empty if there are no items or the mode does not match. */\n  empty() {\n    return !checkoutState.checkout?.line_items?.pagination?.count || (checkoutState?.checkout?.live_mode ? checkoutState?.mode === 'test' : checkoutState?.mode === 'live');\n  }\n\n  getSummaryText() {\n    // If we have an invoice, show the invoice summary text instead.\n    if ((checkoutState.checkout?.invoice as Invoice)?.id) {\n      return this.invoiceSummaryText || __('Invoice Summary', 'surecart');\n    }\n\n    return this.orderSummaryText || __('Summary', 'surecart');\n  }\n\n  renderHeader() {\n    // busy state\n    if ((formBusy() || formLoading()) && !checkoutState.checkout?.line_items?.data?.length) {\n      return (\n        <sc-line-item>\n          <sc-skeleton slot=\"title\" style={{ width: '120px', display: 'inline-block' }}></sc-skeleton>\n          <sc-skeleton slot=\"price\" style={{ 'width': '70px', 'display': 'inline-block', '--border-radius': '6px' }}></sc-skeleton>\n          <sc-skeleton slot=\"currency\" style={{ width: '30px', display: 'inline-block' }}></sc-skeleton>\n        </sc-line-item>\n      );\n    }\n\n    return (\n      <sc-line-item style={{ '--price-size': 'var(--sc-font-size-x-large)' }}>\n        <span\n          class=\"collapse-link\"\n          slot=\"title\"\n          onClick={e => this.handleClick(e)}\n          tabIndex={0}\n          aria-label={sprintf(__('Order Summary %s', 'surecart'), this.collapsed ? __('collapsed', 'surecart') : __('expanded', 'surecart'))}\n          onKeyDown={e => {\n            if (e.key === ' ') {\n              this.handleClick(e);\n              speak(sprintf(__('Order Summary %s', 'surecart'), this.collapsed ? __('collapsed', 'surecart') : __('expanded', 'surecart')), 'assertive');\n            }\n          }}\n        >\n          {this.getSummaryText()}\n          <svg xmlns=\"http://www.w3.org/2000/svg\" class=\"collapse-link__icon\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n            <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M19 9l-7 7-7-7\" />\n          </svg>\n        </span>\n        <span slot=\"description\">\n          <slot name=\"description\" />\n        </span>\n\n        {/* We have a trial, do not show total_savings_amount since it's based on the total_amount */}\n        {checkoutState.checkout?.total_amount !== checkoutState.checkout?.amount_due ? (\n          <span slot=\"price\" class={{ 'price': true, 'price--collapsed': this.collapsed }}>\n            <sc-format-number class=\"total-price\" type=\"currency\" currency={checkoutState.checkout?.currency} value={checkoutState.checkout?.amount_due}></sc-format-number>\n          </span>\n        ) : (\n          <span slot=\"price\" class={{ 'price': true, 'price--collapsed': this.collapsed }}>\n            {!!checkoutState.checkout?.total_savings_amount && (\n              <sc-format-number\n                class=\"total-price scratch-price\"\n                type=\"currency\"\n                value={-checkoutState.checkout?.total_savings_amount + checkoutState.checkout?.total_amount}\n                currency={checkoutState.checkout?.currency || 'usd'}\n              />\n            )}\n            <sc-total class=\"total-price\" total={'total'} order={checkoutState.checkout}></sc-total>\n          </span>\n        )}\n      </sc-line-item>\n    );\n  }\n\n  @Watch('collapsed')\n  async handleOpenChange() {\n    if (!this.collapsed) {\n      this.scShow.emit();\n      await stopAnimations(this.body);\n      this.body.hidden = false;\n      this.body.style.overflow = 'hidden';\n      const { keyframes, options } = getAnimation(this.el, 'summary.show');\n      await animateTo(this.body, shimKeyframesHeightAuto(keyframes, this.body.scrollHeight), options);\n      this.body.style.height = 'auto';\n      this.body.style.overflow = 'visible';\n    } else {\n      this.scHide.emit();\n      await stopAnimations(this.body);\n      this.body.style.overflow = 'hidden';\n      const { keyframes, options } = getAnimation(this.el, 'summary.hide');\n      await animateTo(this.body, shimKeyframesHeightAuto(keyframes, this.body.scrollHeight), options);\n      this.body.hidden = true;\n      this.body.style.height = 'auto';\n      this.body.style.overflow = 'visible';\n    }\n  }\n\n  render() {\n    return (\n      <div class={{ 'summary': true, 'summary--open': !this.collapsed }}>\n        {this.collapsible && this.renderHeader()}\n        <div\n          ref={el => (this.body = el as HTMLElement)}\n          class={{\n            'summary__content': true,\n            'summary__content--empty': this.empty() && !formBusy(),\n          }}\n        >\n          <slot />\n        </div>\n        {this.empty() && !formBusy() && <p class=\"empty\">{__('Your cart is empty.', 'surecart')}</p>}\n      </div>\n    );\n  }\n}\n\nsetDefaultAnimation('summary.show', {\n  keyframes: [\n    { height: '0', opacity: '0' },\n    { height: 'auto', opacity: '1' },\n  ],\n  options: { duration: 250, easing: 'ease' },\n});\n\nsetDefaultAnimation('summary.hide', {\n  keyframes: [\n    { height: 'auto', opacity: '1' },\n    { height: '0', opacity: '0' },\n  ],\n  options: { duration: 250, easing: 'ease' },\n});\n"]}