{"version":3,"file":"sc-shipping-choices.js","sourceRoot":"","sources":["../../../../src/components/ui/sc-shipping-choices/sc-shipping-choices.tsx"],"names":[],"mappings":"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","sourcesContent":["import { Component, Prop, h, Host } from '@stencil/core';\nimport { __, sprintf } from '@wordpress/i18n';\nimport { state as checkoutState } from '@store/checkout';\nimport { Address, Checkout, ShippingMethod } from '../../../types';\nimport { lockCheckout, unLockCheckout } from '@store/checkout/mutations';\nimport { createOrUpdateCheckout } from '@services/session';\nimport { checkoutIsLocked } from '@store/checkout/getters';\nimport { createErrorNotice } from '@store/notices/mutations';\nimport { speak } from '@wordpress/a11y';\nimport { getFormattedPrice } from '../../../functions/price';\n\n/**\n * @part base - The elements base wrapper.\n * @part empty - The empty message.\n * @part block-ui - The block ui loader.\n * @part radio__base - The radio base wrapper.\n * @part radio__label - The radio label.\n * @part radio__control - The radio control wrapper.\n * @part radio__checked-icon - The radio checked icon.\n */\n@Component({\n  tag: 'sc-shipping-choices',\n  styleUrl: 'sc-shipping-choices.scss',\n  shadow: true,\n})\nexport class ScShippingChoices {\n  /** The shipping section label */\n  @Prop() label: string;\n\n  /** Whether to show the shipping choice description */\n  @Prop() showDescription: boolean = true;\n\n  /** Maybe update the order. */\n  async updateCheckout(selectedShippingChoiceId: string) {\n    if (!selectedShippingChoiceId) return;\n    try {\n      lockCheckout('selected_shipping_choice');\n      checkoutState.checkout = (await createOrUpdateCheckout({\n        id: checkoutState.checkout.id,\n        data: {\n          selected_shipping_choice_id: selectedShippingChoiceId,\n        },\n      })) as Checkout;\n\n      speak(__('Shipping choice updated.', 'surecart'), 'assertive');\n      const { total_amount, currency } = checkoutState.checkout;\n\n      /** translators: %1$s: formatted amount */\n      speak(sprintf(__('Your order total has changed to: %1$s.', 'surecart'), getFormattedPrice({ amount: total_amount, currency })), 'assertive');\n    } catch (e) {\n      console.error(e);\n      createErrorNotice(e);\n    } finally {\n      unLockCheckout('selected_shipping_choice');\n    }\n  }\n\n  render() {\n    // shipping choice is not rewquired.\n    if (!checkoutState?.checkout?.selected_shipping_choice_required) {\n      return <Host style={{ display: 'none' }}></Host>;\n    }\n\n    // no shipping choices but no country either\n    if (!checkoutState?.checkout?.shipping_choices?.data?.length && !(checkoutState?.checkout?.shipping_address as Address)?.country) {\n      return (\n        <sc-form-control label={this.label || __('Shipping', 'surecart')}>\n          <div class=\"shipping-choice__empty\">{__('To check available shipping choices, please provide your shipping country in the address section.', 'surecart')}</div>\n        </sc-form-control>\n      );\n    }\n\n    // no shipping choices yet.\n    if (!checkoutState?.checkout?.shipping_choices?.data?.length) {\n      return (\n        <sc-form-control part=\"empty\" label={this.label || __('Shipping', 'surecart')}>\n          <div class=\"shipping-choice__empty\">{__('Sorry, we are not able to ship to your address.', 'surecart')}</div>\n        </sc-form-control>\n      );\n    }\n\n    return (\n      <Host>\n        <sc-radio-group part=\"base\" label={this.label || __('Shipping', 'surecart')} class=\"shipping-choices\" onScChange={e => this.updateCheckout(e.detail)}>\n          {(checkoutState?.checkout?.shipping_choices?.data || []).map(({ id, amount, currency, shipping_method }) => (\n            <sc-radio\n              key={id}\n              checked={checkoutState?.checkout?.selected_shipping_choice === id}\n              exportparts=\"base:radio__base,label:radio__label,control:radio__control,checked-icon:radio__checked-icon\"\n              class=\"shipping-choice\"\n              value={id}\n            >\n              <div class=\"shipping-choice__text\">\n                <div class=\"shipping-choice__name\">{(shipping_method as ShippingMethod)?.name || __('Standard Shipping', 'surecart')}</div>\n                {this.showDescription && !!(shipping_method as ShippingMethod)?.description && (\n                  <div class=\"shipping-choice__description\">{(shipping_method as ShippingMethod)?.description}</div>\n                )}\n              </div>\n              <div class=\"shipping-choice__price\">{!!amount ? <sc-format-number type=\"currency\" value={amount} currency={currency} /> : __('Free', 'surecart')}</div>\n            </sc-radio>\n          ))}\n        </sc-radio-group>\n        {checkoutIsLocked('selected_shipping_choice') && <sc-block-ui></sc-block-ui>}\n      </Host>\n    );\n  }\n}\n"]}