{"version":3,"file":"sc-rich-text.js","sourceRoot":"","sources":["../../../../src/components/ui/rich-text/sc-rich-text.tsx"],"names":[],"mappings":"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","sourcesContent":["import { Component, Event, EventEmitter, h, Host, Prop, State, Listen } from '@stencil/core';\nimport { Editor } from '@tiptap/core';\nimport CharacterCount from '@tiptap/extension-character-count';\nimport Placeholder from '@tiptap/extension-placeholder';\nimport StarterKit from '@tiptap/starter-kit';\nimport { __, sprintf } from '@wordpress/i18n';\n\nlet id = 0;\n\n@Component({\n  tag: 'sc-rich-text',\n  styleUrl: 'sc-rich-text.scss',\n  shadow: true,\n})\nexport class ScRichText {\n  private inputId: string = `sc-richtext-${++id}`;\n  private helpId = `sc-richtext-help-text-${id}`;\n  private labelId = `sc-richtext-label-${id}`;\n\n  /** The textarea's size. */\n  @Prop({ reflect: true }) size: 'small' | 'medium' | 'large' = 'medium';\n\n  /** The textarea's name attribute. */\n  @Prop() name: string;\n\n  /** The textarea's value attribute. */\n  @Prop() value = '';\n\n  /** The textarea's label. Alternatively, you can use the label slot. */\n  @Prop() label = '';\n\n  /** Should we show the label */\n  @Prop() showLabel: boolean = true;\n\n  /** The textarea's help text. Alternatively, you can use the help-text slot. */\n  @Prop() help = '';\n\n  /** The textarea's placeholder text. */\n  @Prop() placeholder: string;\n\n  /** The max length. */\n  @Prop() maxlength: number;\n\n  /** Disables the textarea. */\n  @Prop({ reflect: true }) disabled: boolean = false;\n\n  /** Makes the textarea readonly. */\n  @Prop({ reflect: true }) readonly: boolean = false;\n\n  /** Makes the textarea a required field. */\n  @Prop({ reflect: true }) required: boolean = false;\n\n  @State() updatedAt: any = Date.now();\n  @State() hasFocus: boolean;\n\n  @Event() scChange: EventEmitter<void>;\n  @Event() scInput: EventEmitter<void>;\n  @Event() scBlur: EventEmitter<void>;\n  @Event() scFocus: EventEmitter<void>;\n\n  private element: HTMLDivElement;\n  private editor: any;\n\n  componentDidLoad() {\n    if (this.editor) return;\n    this.editor = new Editor({\n      element: this.element,\n      extensions: [\n        StarterKit,\n        Placeholder.configure({\n          // Use a placeholder:\n          placeholder: this.placeholder,\n        }),\n        ...(this?.maxlength > 0\n          ? [\n              CharacterCount.configure({\n                limit: this.maxlength,\n                mode: 'nodeSize',\n              }),\n            ]\n          : []),\n      ],\n      content: this.value,\n      onCreate: ({ editor }) => {\n        this.value = editor.getHTML();\n      },\n      onUpdate: ({ editor }) => {\n        this.value = editor.getHTML();\n        this.scInput.emit();\n        this.scChange.emit();\n      },\n      onSelectionUpdate: () => {\n        this.updatedAt = Date.now();\n      },\n      onFocus: () => {\n        this.handleFocus();\n      },\n      onBlur: () => {\n        this.handleBlur();\n      },\n    });\n  }\n\n  handleFocus() {\n    this.hasFocus = true;\n    this.scFocus.emit();\n  }\n\n  handleBlur() {\n    this.hasFocus = false;\n    this.scBlur.emit();\n  }\n\n  isActive(type, opts = {}) {\n    return this.editor?.isActive?.(type, opts);\n  }\n\n  toggleHeading(opts) {\n    this.editor.chain().toggleHeading(opts).focus().run();\n  }\n\n  toggleBold() {\n    this.editor.chain().toggleBold().focus().run();\n  }\n\n  toggleItalic() {\n    this.editor.chain().toggleItalic().focus().run();\n  }\n\n  can(property) {\n    return this.editor?.can()?.chain?.()?.focus?.()?.[property]?.()?.run?.();\n  }\n\n  run(property) {\n    return this.editor?.chain?.()?.focus?.()?.[property]?.()?.run?.();\n  }\n\n  remainingCharacters() {\n    if (!this.maxlength) return 1000;\n    return this.maxlength - (this?.editor?.storage?.characterCount.characters() || 0);\n  }\n\n  @Listen('keydown')\n  handleKeyDown(event: KeyboardEvent) {\n    // Prevent keyboard propagation for Jetpack's notification shortcut, which is 'n'.\n    if (event.key === 'n') {\n      event.stopPropagation();\n    }\n  }\n\n  render() {\n    return (\n      <Host>\n        <sc-form-control\n          exportparts=\"label, help-text, form-control\"\n          size={this.size}\n          required={this.required}\n          label={this.label}\n          showLabel={this.showLabel}\n          help={this.help}\n          inputId={this.inputId}\n          helpId={this.helpId}\n          labelId={this.labelId}\n          name={this.name}\n        >\n          <div part=\"base\" class={{ 'editor-base': true, 'editor--focused': this.hasFocus }}>\n            <div class=\"menu\">\n              <sc-button size=\"small\" type={this.editor?.isActive?.('bold') ? 'default' : 'text'} onClick={() => this.run('toggleBold')} disabled={!this.can('toggleBold')}>\n                <sc-icon name=\"bold\" />\n              </sc-button>\n              <sc-button size=\"small\" type={this.editor?.isActive?.('italic') ? 'default' : 'text'} onClick={() => this.run('toggleItalic')} disabled={!this.can('toggleItalic')}>\n                <sc-icon name=\"italic\" />\n              </sc-button>\n              <sc-button size=\"small\" type={this.editor?.isActive?.('bulletList') ? 'default' : 'text'} onClick={() => this.run('toggleBulletList')}>\n                <sc-icon name=\"list\" />\n              </sc-button>\n              <sc-button size=\"small\" type={this.editor?.isActive?.('strike') ? 'default' : 'text'} onClick={() => this.run('toggleStrike')}>\n                <sc-icon name=\"minus\" />\n              </sc-button>\n              <sc-button class=\"right\" size=\"small\" type=\"text\" onClick={() => this.run('undo')} disabled={!this.can('undo')}>\n                <sc-icon name=\"corner-up-left\" />\n              </sc-button>\n              <sc-button size=\"small\" type=\"text\" onClick={() => this.run('redo')} disabled={!this.can('redo')}>\n                <sc-icon name=\"corner-up-right\" />\n              </sc-button>\n            </div>\n            <div\n              part=\"editor\"\n              class={{\n                editor: true,\n              }}\n              ref={el => (this.element = el as HTMLDivElement)}\n            ></div>\n          </div>\n          {this.remainingCharacters() < 20 && <div class={'textarea__char-limit-warning'}>{sprintf(__('%d characters remaining', 'surecart'), this.remainingCharacters())}</div>}\n        </sc-form-control>\n      </Host>\n    );\n  }\n}\n"]}