{"version":3,"file":"sc-licenses-list.js","sourceRoot":"","sources":["../../../../../src/components/controllers/dashboard/sc-licenses-list/sc-licenses-list.tsx"],"names":[],"mappings":"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","sourcesContent":["import { Component, Element, h, Prop, State } from '@stencil/core';\nimport { __, sprintf } from '@wordpress/i18n';\nimport { License, Purchase, Product } from '../../../../types';\nimport { onFirstVisible } from '../../../../functions/lazy';\nimport apiFetch from '../../../../functions/fetch';\nimport { addQueryArgs } from '@wordpress/url';\n\n@Component({\n  tag: 'sc-licenses-list',\n  styleUrl: 'sc-licenses-list.css',\n  shadow: true,\n})\nexport class ScLicensesList {\n  @Element() el: HTMLScLicensesListElement;\n\n  /** Query to fetch licenses */\n  @Prop({ mutable: true }) query: {\n    page: number;\n    per_page: number;\n  } = {\n    page: 1,\n    per_page: 10,\n  };\n  /**The heading of the licenses */\n  @Prop() heading: string = __('Licenses', 'surecart');\n  /**Whether the current user is customer */\n  @Prop() isCustomer: boolean;\n  /**View all link */\n  @Prop() allLink: string;\n\n  @Prop({ mutable: true }) licenses: License[] = [];\n  @State() copied: boolean = false;\n  @State() loading: boolean = false;\n  @State() error: string = '';\n  @State() pagination: {\n    total: number;\n    total_pages: number;\n  } = {\n    total: 0,\n    total_pages: 0,\n  };\n\n  /** Only fetch if visible */\n  componentWillLoad() {\n    onFirstVisible(this.el, () => {\n      this.initialFetch();\n    });\n  }\n\n  async initialFetch() {\n    try {\n      this.loading = true;\n      await this.getLicenses();\n    } catch (e) {\n      console.error(e);\n      this.error = e?.message || __('Something went wrong', 'surecart');\n    } finally {\n      this.loading = false;\n    }\n  }\n\n  async getLicenses() {\n    if (!this.isCustomer) {\n      return;\n    }\n\n    const response = (await await apiFetch({\n      path: addQueryArgs('surecart/v1/licenses', {\n        expand: ['purchase', 'purchase.product', 'activations'],\n        ...this.query,\n      }),\n      parse: false,\n    })) as Response;\n\n    this.pagination = {\n      total: parseInt(response.headers.get('X-WP-Total')),\n      total_pages: parseInt(response.headers.get('X-WP-TotalPages')),\n    };\n    this.licenses = (await response.json()) as License[];\n    return this.licenses;\n  }\n\n  renderStatus(status: string) {\n    if (status === 'active') {\n      return <sc-tag type=\"success\">{__('Active', 'surecart')}</sc-tag>;\n    }\n    if (status === 'revoked') {\n      return <sc-tag type=\"danger\">{__('Revoked', 'surecart')}</sc-tag>;\n    }\n    if (status === 'inactive') {\n      return <sc-tag type=\"info\">{__('Not Activated', 'surecart')}</sc-tag>;\n    }\n    return <sc-tag type=\"info\">{status}</sc-tag>;\n  }\n\n  async copyKey(key: string) {\n    try {\n      await navigator.clipboard.writeText(key);\n      this.copied = true;\n\n      setTimeout(() => {\n        this.copied = false;\n      }, 2000);\n    } catch (err) {\n      console.error(err);\n      alert(__('Error copying to clipboard', 'surecart'));\n    }\n  }\n\n  renderLoading() {\n    return (\n      <sc-card no-padding style={{ '--overflow': 'hidden' }}>\n        <sc-stacked-list>\n          <sc-stacked-list-row style={{ '--columns': '2' }} mobile-size={0}>\n            <div style={{ padding: '0.5em' }}>\n              <sc-skeleton style={{ width: '30%', marginBottom: '0.75em' }}></sc-skeleton>\n              <sc-skeleton style={{ width: '20%', marginBottom: '0.75em' }}></sc-skeleton>\n              <sc-skeleton style={{ width: '40%' }}></sc-skeleton>\n            </div>\n          </sc-stacked-list-row>\n        </sc-stacked-list>\n      </sc-card>\n    );\n  }\n\n  renderEmpty() {\n    return (\n      <div>\n        <sc-divider style={{ '--spacing': '0' }}></sc-divider>\n        <slot name=\"empty\">\n          <sc-empty icon=\"file-text\">{__(\"You don't have any licenses.\", 'surecart')}</sc-empty>\n        </slot>\n      </div>\n    );\n  }\n\n  renderContent() {\n    if (this.loading) {\n      return this.renderLoading();\n    }\n\n    if (this.licenses?.length === 0) {\n      return this.renderEmpty();\n    }\n\n    return (\n      <sc-card no-padding>\n        <sc-stacked-list>\n          {this.licenses?.map(({ id, purchase, status, activation_limit, activation_count }) => (\n            <sc-stacked-list-row\n              key={id}\n              href={addQueryArgs(window.location.href, {\n                action: 'show',\n                model: 'license',\n                id,\n              })}\n              mobile-size={0}\n            >\n              <div class=\"license__details\">\n                <div class=\"license__name\">{((purchase as Purchase)?.product as Product)?.name}</div>\n                <div>\n                  {this.renderStatus(status)} {sprintf(__('%1s of %2s Activations Used'), activation_count || 0, activation_limit || '∞')}\n                </div>\n              </div>\n              {/* <div>{this.renderStatus(status)}</div> */}\n              <sc-icon name=\"chevron-right\" slot=\"suffix\"></sc-icon>\n              {/* <sc-tag type=\"info\">{sprintf(__('%1s of %2s Activations Used'), activation_count || 0, activation_limit || '∞')}</sc-tag> */}\n            </sc-stacked-list-row>\n          ))}\n        </sc-stacked-list>\n      </sc-card>\n    );\n  }\n\n  render() {\n    return (\n      <sc-dashboard-module class=\"purchase\" part=\"base\" error={this.error}>\n        <span slot=\"heading\">\n          <slot name=\"heading\">{this.heading || __('License Keys', 'surecart')}</slot>\n        </span>\n        {!!this.allLink && !!this.licenses?.length && (\n          <sc-button type=\"link\" href={this.allLink} slot=\"end\">\n            {__('View all', 'surecart')}\n            <sc-icon name=\"chevron-right\" slot=\"suffix\"></sc-icon>\n          </sc-button>\n        )}\n\n        {this.renderContent()}\n      </sc-dashboard-module>\n    );\n  }\n}\n"]}