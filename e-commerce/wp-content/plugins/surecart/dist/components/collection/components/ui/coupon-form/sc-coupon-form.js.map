{"version":3,"file":"sc-coupon-form.js","sourceRoot":"","sources":["../../../../src/components/ui/coupon-form/sc-coupon-form.tsx"],"names":[],"mappings":"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","sourcesContent":["import { Component, Element, h, Prop, State, Watch, Fragment, Method, Event, EventEmitter } from '@stencil/core';\nimport { speak } from '@wordpress/a11y';\nimport { __, sprintf, _n } from '@wordpress/i18n';\nimport { isRtl } from '../../../functions/page-align';\nimport { getHumanDiscount, getHumanDiscountRedeemableStatus } from '../../../functions/price';\nimport { DiscountResponse } from '../../../types';\nimport { state as checkoutState } from '../../../store/checkout';\n\n/**\n * @part base - The elements base wrapper.\n * @part form - The form.\n * @part input__base - The input base.\n * @part input - The input.\n * @part input__form-control - The input form control.\n * @part button__base - The button base element.\n * @part button__label - The button label.\n * @part info - The discount info.\n * @part discount - The discount displayed (% off)\n * @part amount - The discount amount.\n * @part discount-label - The discount label.\n * @part coupon-tag - The coupon tag.\n * @part error__base - The error base.\n * @part error__icon - The error icon\n * @part error__text - The error text.\n * @part error_title - The error title.\n * @part error__message - The error message.\n * @part block-ui - The block ui base component.\n * @part block-ui__content - The block ui content (spinner).\n */\n@Component({\n  tag: 'sc-coupon-form',\n  styleUrl: 'sc-coupon-form.scss',\n  shadow: true,\n})\nexport class ScCouponForm {\n  @Element() el: HTMLScCouponFormElement;\n  private input: HTMLScInputElement;\n  private couponTag: HTMLScTagElement;\n  private addCouponTrigger: HTMLElement;\n\n  /** The label for the coupon form */\n  @Prop() label: string;\n\n  /** Is the form loading */\n  @Prop() loading: boolean;\n\n  /** Is the form calculating */\n  @Prop() busy: boolean;\n\n  /** The placeholder for the input */\n  @Prop() placeholder: string;\n\n  /** The error message */\n  @Prop({ mutable: true }) error: string;\n\n  /** Force the form to show */\n  @Prop() forceOpen: boolean;\n\n  /** The discount */\n  @Prop() discount: DiscountResponse;\n\n  /** Currency */\n  @Prop() currency: string;\n\n  /** The discount amount */\n  @Prop() discountAmount: number;\n\n  /** Has recurring */\n  @Prop() showInterval: boolean;\n\n  /** Is it open */\n  @Prop({ mutable: true }) open: boolean;\n\n  @Prop() collapsed: boolean;\n\n  /** The value of the input */\n  @State() value: string;\n\n  /** When the coupon is applied */\n  @Event() scApplyCoupon: EventEmitter<string>;\n\n  /** The text for apply button */\n  @Prop({ reflect: true }) buttonText: string;\n\n  /** Is the form editable */\n  @Prop() editable: boolean = true;\n\n  /** Auto focus the input when opened. */\n  @Watch('open')\n  handleOpenChange(val) {\n    if (val) {\n      setTimeout(() => this.input.triggerFocus(), 50);\n    }\n  }\n\n  /** Close it when blurred and no value. */\n  handleBlur() {\n    if (!this.value) {\n      this.open = false;\n      this.error = '';\n    }\n  }\n\n  getHumanReadableDiscount() {\n    if (this?.discount?.coupon && this?.discount?.coupon.percent_off) {\n      return getHumanDiscount(this?.discount?.coupon);\n    }\n    return '';\n  }\n\n  /** Apply the coupon. */\n  applyCoupon() {\n    this.scApplyCoupon.emit(this.value);\n  }\n\n  handleKeyDown(e) {\n    if (e?.code === 'Enter') {\n      this.applyCoupon();\n    } else if (e?.code === 'Escape') {\n      this.scApplyCoupon.emit(null);\n      this.open = false;\n      speak(__('Coupon code field closed.', 'surecart'), 'assertive');\n    }\n  }\n\n  translateHumanDiscountWithDuration(humanDiscount) {\n    if (!this.showInterval) return humanDiscount;\n\n    const { duration, duration_in_months } = this.discount?.coupon;\n    switch (duration) {\n      case 'once':\n        return `${humanDiscount} ${__('once', 'surecart')}`;\n      case 'repeating':\n        const monthsLabel = sprintf(_n('%d month', '%d months', duration_in_months, 'surecart'), duration_in_months);\n        // translators: %s is the discount amount, %s is the duration (e.g. 3 months)\n        return sprintf(__('%s for %s', 'surecart'), humanDiscount, monthsLabel);\n      default:\n        return humanDiscount;\n    }\n  }\n\n  /** Focus the input. */\n  @Method()\n  async triggerFocus() {\n    await new Promise(resolve => requestAnimationFrame(resolve));\n\n    if (this?.discount?.promotion?.code) {\n      (this.couponTag.shadowRoot.querySelector('*') as HTMLElement)?.focus();\n    } else if (this.addCouponTrigger) {\n      this.addCouponTrigger.focus();\n    }\n  }\n\n  renderTrialText() {\n    if (this.discount?.coupon?.duration === 'once') {\n      return __('Applies on first payment', 'surecart');\n    }\n    return __('Starting on first payment', 'surecart');\n  }\n\n  render() {\n    const isFreeTrial = !!checkoutState?.checkout?.trial_amount && !checkoutState?.checkout?.amount_due;\n\n    if (this.loading) {\n      return <sc-skeleton style={{ width: '120px', display: 'inline-block' }}></sc-skeleton>;\n    }\n\n    if (this?.discount?.promotion?.code) {\n      let humanDiscount = this.getHumanReadableDiscount();\n\n      return (\n        <sc-line-item exportparts=\"description:info, price-description:discount, price:amount\">\n          <span slot=\"description\">\n            <div part=\"discount-label\">{__('Discount', 'surecart')}</div>\n            <sc-tag\n              exportparts=\"base:coupon-tag\"\n              type={'redeemable' === this.discount?.redeemable_status ? 'success' : 'warning'}\n              class=\"coupon-tag\"\n              clearable={this.editable}\n              onScClear={() => {\n                if (!this.editable) return;\n                this.scApplyCoupon.emit(null);\n                this.open = false;\n              }}\n              onKeyDown={e => {\n                if (!this.editable) return;\n                if (e.key === 'Enter' || e.key === 'Escape') {\n                  speak(__('Coupon was removed.', 'surecart'), 'assertive');\n                  this.scApplyCoupon.emit(null);\n                  this.open = false;\n                }\n              }}\n              ref={el => (this.couponTag = el as HTMLScTagElement)}\n              role=\"button\"\n              // translators: %s is the coupon code.\n              aria-label={sprintf(__('Press enter to remove coupon code %s.', 'surecart'), this?.discount?.promotion?.code || this.input.value || '')}\n            >\n              {this?.discount?.promotion?.code}\n            </sc-tag>\n          </span>\n\n          {'redeemable' === this.discount?.redeemable_status ? (\n            <Fragment>\n              {humanDiscount && (\n                <span class=\"coupon-human-discount\" slot=\"price-description\">\n                  {this.translateHumanDiscountWithDuration(humanDiscount)}\n                </span>\n              )}\n              <span slot={isFreeTrial ? 'price-description' : 'price'}>\n                {isFreeTrial ? this.renderTrialText() : <sc-format-number type=\"currency\" currency={this?.currency} value={this?.discountAmount}></sc-format-number>}\n              </span>\n            </Fragment>\n          ) : (\n            <div class=\"coupon__status\" slot=\"price-description\">\n              <sc-icon name=\"alert-triangle\" />\n              {getHumanDiscountRedeemableStatus(this.discount?.redeemable_status)}\n            </div>\n          )}\n        </sc-line-item>\n      );\n    }\n\n    return this.collapsed ? (\n      <div\n        part=\"base\"\n        class={{\n          'coupon-form': true,\n          'coupon-form--is-open': this.open || this.forceOpen,\n          'coupon-form--has-value': !!this.value,\n          'coupon-form--is-rtl': isRtl(),\n        }}\n      >\n        <div\n          part=\"label\"\n          class=\"trigger\"\n          onMouseDown={() => {\n            if (this.open) {\n              return;\n            }\n            this.open = true;\n          }}\n          onKeyDown={e => {\n            if (e.key !== 'Enter' && e.key !== ' ') {\n              return true;\n            }\n            if (this.open) {\n              return;\n            }\n            this.open = true;\n            speak(__('Coupon code field opened. Press Escape button to close it.', 'surecart'), 'assertive');\n          }}\n          tabindex=\"0\"\n          ref={el => (this.addCouponTrigger = el as HTMLElement)}\n          role=\"button\"\n        >\n          <slot name=\"label\">{this.label}</slot>\n        </div>\n\n        <div class=\"form\" part=\"form\">\n          <sc-input\n            exportparts=\"base:input__base, input, form-control:input__form-control\"\n            value={this.value}\n            onScInput={(e: any) => (this.value = e.target.value)}\n            placeholder={this.placeholder}\n            onScBlur={() => this.handleBlur()}\n            onKeyDown={e => this.handleKeyDown(e)}\n            ref={el => (this.input = el as HTMLScInputElement)}\n            aria-label={__('Add coupon code.', 'surecart')}\n          >\n            <sc-button\n              exportparts=\"base:button__base, label:button_label\"\n              slot=\"suffix\"\n              type=\"text\"\n              loading={this.busy}\n              size=\"medium\"\n              class=\"coupon-button\"\n              onClick={() => this.applyCoupon()}\n            >\n              <slot>{this.buttonText}</slot>\n            </sc-button>\n          </sc-input>\n          <sc-button\n            exportparts=\"base:button__base, label:button_label\"\n            type=\"primary\"\n            outline\n            loading={this.busy}\n            size=\"medium\"\n            class=\"coupon-button-mobile\"\n            onClick={() => this.applyCoupon()}\n          >\n            <slot>{this.buttonText}</slot>\n          </sc-button>\n          {!!this.error && (\n            <sc-alert exportparts=\"base:error__base, icon:error__icon, text:error__text, title:error_title, message:error__message\" type=\"danger\" open>\n              <span slot=\"title\">{this.error}</span>\n            </sc-alert>\n          )}\n        </div>\n\n        {this.loading && <sc-block-ui exportparts=\"base:block-ui, content:block-ui__content\"></sc-block-ui>}\n      </div>\n    ) : (\n      <div\n        class={{\n          'coupon-form': true,\n          'coupon-form--has-value': !!this.value,\n          'coupon-form--is-rtl': isRtl(),\n        }}\n      >\n        <sc-input\n          label={this.label}\n          exportparts=\"base:input__base, input, form-control:input__form-control\"\n          value={this.value}\n          onScInput={(e: any) => (this.value = e.target.value)}\n          placeholder={this.placeholder}\n          onScBlur={() => this.handleBlur()}\n          onKeyDown={e => this.handleKeyDown(e)}\n          ref={el => (this.input = el as HTMLScInputElement)}\n        >\n          <sc-button\n            exportparts=\"base:button__base, label:button_label\"\n            slot=\"suffix\"\n            type=\"text\"\n            loading={this.busy}\n            size=\"medium\"\n            class=\"coupon-button\"\n            onClick={() => this.applyCoupon()}\n          >\n            <slot>{this.buttonText}</slot>\n          </sc-button>\n        </sc-input>\n        <sc-button\n          exportparts=\"base:button__base, label:button_label\"\n          type=\"primary\"\n          outline\n          loading={this.busy}\n          size=\"medium\"\n          class=\"coupon-button-mobile\"\n          onClick={() => this.applyCoupon()}\n        >\n          <slot>{this.buttonText}</slot>\n        </sc-button>\n        {!!this.error && (\n          <sc-alert exportparts=\"base:error__base, icon:error__icon, text:error__text, title:error_title, message:error__message\" type=\"danger\" open>\n            <span slot=\"title\">{this.error}</span>\n          </sc-alert>\n        )}\n      </div>\n    );\n  }\n}\n"]}