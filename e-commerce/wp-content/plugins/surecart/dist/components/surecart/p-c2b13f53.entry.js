import{r as e,h as t}from"./p-e97fde0a.js";import{p as i}from"./p-9ef0f73f.js";import{a as d}from"./p-9a298389.js";import{a as s}from"./p-401e165e.js";import"./p-d3366af3.js";const a="sc-stripe-add-method{display:block}sc-stripe-add-method [hidden]{display:none}.loader{display:grid;height:128px;gap:2em}.loader__row{display:flex;align-items:flex-start;justify-content:space-between;gap:1em}.loader__details{display:grid;gap:0.5em}";const o=a;const n=class{constructor(t){e(this,t);this.liveMode=true;this.customerId=undefined;this.successUrl=undefined;this.loading=undefined;this.loaded=undefined;this.error=undefined;this.paymentIntent=undefined}componentWillLoad(){this.createPaymentIntent()}async handlePaymentIntentCreate(){var e,t,d,s,a,o,n,c,r,l,h,f,u,p,m,v,y,b;if(!((d=(t=(e=this.paymentIntent)===null||e===void 0?void 0:e.processor_data)===null||t===void 0?void 0:t.stripe)===null||d===void 0?void 0:d.publishable_key)||!((o=(a=(s=this.paymentIntent)===null||s===void 0?void 0:s.processor_data)===null||a===void 0?void 0:a.stripe)===null||o===void 0?void 0:o.account_id))return;if(!this.stripe){try{this.stripe=await i.loadStripe((r=(c=(n=this.paymentIntent)===null||n===void 0?void 0:n.processor_data)===null||c===void 0?void 0:c.stripe)===null||r===void 0?void 0:r.publishable_key,{stripeAccount:(f=(h=(l=this.paymentIntent)===null||l===void 0?void 0:l.processor_data)===null||h===void 0?void 0:h.stripe)===null||f===void 0?void 0:f.account_id})}catch(e){this.error=(e===null||e===void 0?void 0:e.message)||wp.i18n.__("Stripe could not be loaded","surecart");return}}if(!((m=(p=(u=this.paymentIntent)===null||u===void 0?void 0:u.processor_data)===null||p===void 0?void 0:p.stripe)===null||m===void 0?void 0:m.client_secret)||!this.container){console.warn("do not have client secret or container");return}const k=getComputedStyle(document.body);this.elements=this.stripe.elements({clientSecret:(b=(y=(v=this.paymentIntent)===null||v===void 0?void 0:v.processor_data)===null||y===void 0?void 0:y.stripe)===null||b===void 0?void 0:b.client_secret,appearance:{variables:{colorPrimary:k.getPropertyValue("--sc-color-primary-500"),colorText:k.getPropertyValue("--sc-input-label-color"),borderRadius:k.getPropertyValue("--sc-input-border-radius-medium"),colorBackground:k.getPropertyValue("--sc-input-background-color"),fontSizeBase:k.getPropertyValue("--sc-input-font-size-medium")},rules:{".Input":{border:k.getPropertyValue("--sc-input-border")},".Input::placeholder":{color:k.getPropertyValue("--sc-input-placeholder-color")}}}});this.elements.create("payment",{wallets:{applePay:"never",googlePay:"never"}}).mount(".sc-payment-element-container");this.element=this.elements.getElement("payment");this.element.on("ready",(()=>this.loaded=true))}async createPaymentIntent(){try{this.loading=true;this.error="";this.paymentIntent=await d({method:"POST",path:"surecart/v1/payment_intents",data:{processor_type:"stripe",live_mode:this.liveMode,customer_id:this.customerId,refresh_status:true}})}catch(e){this.error=(e===null||e===void 0?void 0:e.message)||wp.i18n.__("Something went wrong","surecart")}finally{this.loading=false}}async handleSubmit(e){var t;e.preventDefault();this.loading=true;try{const e=await this.stripe.confirmSetup({elements:this.elements,confirmParams:{return_url:s(this.successUrl,{payment_intent:(t=this.paymentIntent)===null||t===void 0?void 0:t.id})},redirect:"always"});if(e===null||e===void 0?void 0:e.error){this.error=e.error.message;throw e.error}}catch(e){console.error(e);this.error=(e===null||e===void 0?void 0:e.message)||wp.i18n.__("Something went wrong","surecart");this.loading=false}}render(){return t("sc-form",{key:"8c61c18dddcb1fdb3c424f0cf74ca3130db603e1",onScFormSubmit:e=>this.handleSubmit(e)},this.error&&t("sc-alert",{key:"113aa9076dbf54fa958e1a614c0ddaf9d04c7068",open:!!this.error,type:"danger"},t("span",{key:"5a9d095446153060fa147c67284419a9100a77e4",slot:"title"},wp.i18n.__("Error","surecart")),this.error),t("div",{key:"5c92d4ea9200f8717b16c8c41e14074c0e6b2217",class:"loader",hidden:this.loaded},t("div",{key:"d8d577867c58ed1605cf95c95a0944ee968a36c7",class:"loader__row"},t("div",{key:"8aef0469696016456b56aeff097a18ebf5d13038",style:{width:"50%"}},t("sc-skeleton",{key:"b8a5d42b541dbc1e586e7cbcd9c38d1409e16508",style:{width:"50%",marginBottom:"0.5em"}}),t("sc-skeleton",{key:"5b9f10513f82aba9e5f662df342d7c80924315a2"})),t("div",{key:"aab6864f8fe46598f3911b0e79d53e6223d34821",style:{flex:"1"}},t("sc-skeleton",{key:"457225068ac043035c5c9ff2d16b372a9e53eac2",style:{width:"50%",marginBottom:"0.5em"}}),t("sc-skeleton",{key:"df9a1f2013692bfc89f3c1e2ed87298e3993438c"})),t("div",{key:"635b4e0f037c0393f56e1fc3b6db24b75dd8e42d",style:{flex:"1"}},t("sc-skeleton",{key:"2c5d47cc922c70dc0e86d6718e546533399902b0",style:{width:"50%",marginBottom:"0.5em"}}),t("sc-skeleton",{key:"5b20d1c4e1189235059dfe3dce24b2d5a3a7636c"}))),t("div",{key:"1a90f3eeb1f0ab8e9cc2c8131c412a2a0493c6f2",class:"loader__details"},t("sc-skeleton",{key:"bfb030c579f0cb252a4f91199ad2e351af1064bc",style:{height:"1rem"}}),t("sc-skeleton",{key:"b1d211aca29f5b5a392b841610787e1785fa54e8",style:{height:"1rem",width:"30%"}}))),t("div",{key:"e577ca459ff1d0a3aa0f497c37decc4d0b457e39",hidden:!this.loaded,class:"sc-payment-element-container",ref:e=>this.container=e}),t("sc-button",{key:"9148e3e13078fee631c0f648861654575123567b",type:"primary",submit:true,full:true,loading:this.loading},wp.i18n.__("Save Payment Method","surecart")))}static get watchers(){return{paymentIntent:["handlePaymentIntentCreate"]}}};n.style=o;export{n as sc_stripe_add_method};
//# sourceMappingURL=p-c2b13f53.entry.js.map