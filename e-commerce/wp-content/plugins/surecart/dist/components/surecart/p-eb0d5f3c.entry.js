import{r as t,h as e,H as i}from"./p-e97fde0a.js";import{l as a,g as s}from"./p-e885ba5f.js";import{a as n}from"./p-9a298389.js";import"./p-401e165e.js";import"./p-d3366af3.js";const r=':host{display:block}.paypal-buttons{position:relative;line-height:0;text-align:center}.paypal-buttons:after{content:" ";border-bottom:1px solid var(--sc-input-border-color);width:100%;height:0;top:50%;left:0;right:0;position:absolute}';const o=r;const d=class{constructor(e){t(this,e);this.liveMode=true;this.customerId=undefined;this.successUrl=undefined;this.currency=undefined;this.loading=undefined;this.loaded=undefined;this.error=undefined;this.paymentIntent=undefined}componentWillLoad(){this.createPaymentIntent()}async handlePaymentIntentCreate(){var t,e;const{external_intent_id:i}=this.paymentIntent||{};const{client_id:r,account_id:o,merchant_initiated:d}=((e=(t=this.paymentIntent)===null||t===void 0?void 0:t.processor_data)===null||e===void 0?void 0:e.paypal)||{};if(!r||!o||!i)return;if(!this.paypal){try{this.paypal=await a(s({clientId:r,merchantId:o,merchantInitiated:d,reusable:true}));this.paypal.Buttons({onInit:()=>{this.loaded=true},createBillingAgreement:()=>new Promise((t=>t(i))),onApprove:async()=>{var t;try{this.loading=true;const e=await n({method:"PATCH",path:`surecart/v1/payment_intents/${(t=this.paymentIntent)===null||t===void 0?void 0:t.id}/capture`});if(["succeeded","pending","requires_approval"].includes(e===null||e===void 0?void 0:e.status)){window.location.assign(this.successUrl)}else{throw{message:wp.i18n.__("The payment did not process. Please try again.","surecart")}}}catch(t){console.error(t);this.error=(t===null||t===void 0?void 0:t.message)||wp.i18n.__("The payment did not process. Please try again.","surecart");this.loading=false}},onError:t=>{console.error(t);alert((t===null||t===void 0?void 0:t.message)||wp.i18n.__("The payment did not process. Please try again.","surecart"))}}).render(this.container)}catch(t){console.error("Failed to load the PayPal JS SDK script",t);this.error=wp.i18n.__("Failed to load the PayPal JS SDK script","surecart")}}}async createPaymentIntent(){var t,e;try{this.loading=true;this.error="";this.paymentIntent=await n({method:"POST",path:"surecart/v1/payment_intents",data:{processor_type:"paypal",reusable:true,live_mode:this.liveMode,customer_id:this.customerId,currency:this.currency,refresh_status:true}})}catch(i){this.error=((e=(t=i===null||i===void 0?void 0:i.additional_errors)===null||t===void 0?void 0:t[0])===null||e===void 0?void 0:e.message)||(i===null||i===void 0?void 0:i.message)||wp.i18n.__("Something went wrong","surecart")}finally{this.loading=false}}render(){return e(i,{key:"8248c22c8a4cbb1746e50102af66a65284f4ca1b"},this.error&&e("sc-alert",{key:"c170d57805570a508df704d1f034c18bfc362ef3",open:!!this.error,type:"danger"},e("span",{key:"f34ce3790ed8f2d082d226e03a243f34d5b67c62",slot:"title"},wp.i18n.__("Error","surecart")),this.error),e("div",{key:"1ec2c4534cc4aa0f1125a9ca9feed7a718c9d657",class:"sc-paypal-button-container",hidden:!this.loaded,ref:t=>this.container=t}))}static get watchers(){return{paymentIntent:["handlePaymentIntentCreate"]}}};d.style=o;export{d as sc_paypal_add_method};
//# sourceMappingURL=p-eb0d5f3c.entry.js.map